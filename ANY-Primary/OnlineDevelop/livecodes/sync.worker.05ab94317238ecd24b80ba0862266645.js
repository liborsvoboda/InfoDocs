(function(){var zo=Object.create;var $n=Object.defineProperty;var qo=Object.getOwnPropertyDescriptor;var Ho=Object.getOwnPropertyNames;var Jo=Object.getPrototypeOf,Go=Object.prototype.hasOwnProperty;var Wo=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ko=(e,t)=>{for(var n in t)$n(e,n,{get:t[n],enumerable:!0})},Zo=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Ho(t))!Go.call(e,s)&&s!==n&&$n(e,s,{get:()=>t[s],enumerable:!(r=qo(t,s))||r.enumerable});return e};var Yo=(e,t,n)=>(n=e!=null?zo(Jo(e)):{},Zo(t||!e||!e.__esModule?$n(n,"default",{value:e,enumerable:!0}):n,e));var Vo=Wo((Or,Mo)=>{(function(e,t){var n=t(e);if(typeof define=="function"&&define.amd)define("DeepDiff",function(){return n});else if(typeof Or=="object"||typeof navigator=="object"&&navigator.product.match(/ReactNative/i))Mo.exports=n;else{var r=e.DeepDiff;n.noConflict=function(){return e.DeepDiff===n&&(e.DeepDiff=r),n},e.DeepDiff=n}})(Or,function(e){var t=["N","E","A","D"];function n(g,m){g.super_=m,g.prototype=Object.create(m.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}function r(g,m){Object.defineProperty(this,"kind",{value:g,enumerable:!0}),m&&m.length&&Object.defineProperty(this,"path",{value:m,enumerable:!0})}function s(g,m,p){s.super_.call(this,"E",g),Object.defineProperty(this,"lhs",{value:m,enumerable:!0}),Object.defineProperty(this,"rhs",{value:p,enumerable:!0})}n(s,r);function o(g,m){o.super_.call(this,"N",g),Object.defineProperty(this,"rhs",{value:m,enumerable:!0})}n(o,r);function i(g,m){i.super_.call(this,"D",g),Object.defineProperty(this,"lhs",{value:m,enumerable:!0})}n(i,r);function c(g,m,p){c.super_.call(this,"A",g),Object.defineProperty(this,"index",{value:m,enumerable:!0}),Object.defineProperty(this,"item",{value:p,enumerable:!0})}n(c,r);function a(g,m,p){var b=g.slice((p||m)+1||g.length);return g.length=m<0?g.length+m:m,g.push.apply(g,b),g}function l(g){var m=typeof g;return m!=="object"?m:g===Math?"math":g===null?"null":Array.isArray(g)?"array":Object.prototype.toString.call(g)==="[object Date]"?"date":typeof g.toString=="function"&&/^\/.*\//.test(g.toString())?"regexp":"object"}function d(g){var m=0;if(g.length===0)return m;for(var p=0;p<g.length;p++){var b=g.charCodeAt(p);m=(m<<5)-m+b,m=m&m}return m}function u(g){var m=0,p=l(g);if(p==="array"){g.forEach(function(Nt){m+=u(Nt)});var b="[type: array, hash: "+m+"]";return m+d(b)}if(p==="object"){for(var w in g)if(g.hasOwnProperty(w)){var _="[ type: object, key: "+w+", value hash: "+u(g[w])+"]";m+=d(_)}return m}var E="[ type: "+p+" ; value: "+g+"]";return m+d(E)}function h(g,m,p,b,w,_,E,Nt){p=p||[],w=w||[],E=E||[];var V=w.slice(0);if(typeof _<"u"&&_!==null){if(b){if(typeof b=="function"&&b(V,_))return;if(typeof b=="object"){if(b.prefilter&&b.prefilter(V,_))return;if(b.normalize){var Mn=b.normalize(V,_,g,m);Mn&&(g=Mn[0],m=Mn[1])}}}V.push(_)}l(g)==="regexp"&&l(m)==="regexp"&&(g=g.toString(),m=m.toString());var Vn=typeof g,Po=typeof m,j,be,nt,xe,Rr=Vn!=="undefined"||E&&E.length>0&&E[E.length-1].lhs&&Object.getOwnPropertyDescriptor(E[E.length-1].lhs,_),Fr=Po!=="undefined"||E&&E.length>0&&E[E.length-1].rhs&&Object.getOwnPropertyDescriptor(E[E.length-1].rhs,_);if(!Rr&&Fr)p.push(new o(V,m));else if(!Fr&&Rr)p.push(new i(V,g));else if(l(g)!==l(m))p.push(new s(V,g,m));else if(l(g)==="date"&&g-m!==0)p.push(new s(V,g,m));else if(Vn==="object"&&g!==null&&m!==null){for(j=E.length-1;j>-1;--j)if(E[j].lhs===g){xe=!0;break}if(xe)g!==m&&p.push(new s(V,g,m));else{if(E.push({lhs:g,rhs:m}),Array.isArray(g)){for(Nt&&(g.sort(function(Rn,Fn){return u(Rn)-u(Fn)}),m.sort(function(Rn,Fn){return u(Rn)-u(Fn)})),j=m.length-1,be=g.length-1;j>be;)p.push(new c(V,j,new o(void 0,m[j--])));for(;be>j;)p.push(new c(V,be,new i(void 0,g[be--])));for(;j>=0;--j)h(g[j],m[j],p,b,V,j,E,Nt)}else{var $r=Object.keys(g),Ge=Object.keys(m);for(j=0;j<$r.length;++j)nt=$r[j],xe=Ge.indexOf(nt),xe>=0?(h(g[nt],m[nt],p,b,V,nt,E,Nt),Ge[xe]=null):h(g[nt],void 0,p,b,V,nt,E,Nt);for(j=0;j<Ge.length;++j)nt=Ge[j],nt&&h(void 0,m[nt],p,b,V,nt,E,Nt)}E.length=E.length-1}}else g!==m&&(Vn==="number"&&isNaN(g)&&isNaN(m)||p.push(new s(V,g,m)))}function f(g,m,p,b,w){var _=[];if(h(g,m,_,b,null,null,null,w),p)for(var E=0;E<_.length;++E)p(_[E]);return _}function y(g,m,p,b,w,_,E){return h(g,m,p,b,w,_,E,!0)}function x(g,m,p,b){var w=b?function(E){E&&b.push(E)}:void 0,_=f(g,m,w,p);return b||(_.length?_:void 0)}function U(g,m,p,b){var w=b?function(E){E&&b.push(E)}:void 0,_=f(g,m,w,p,!0);return b||(_.length?_:void 0)}function C(g,m,p){if(p.path&&p.path.length){var b=g[m],w,_=p.path.length-1;for(w=0;w<_;w++)b=b[p.path[w]];switch(p.kind){case"A":C(b[p.path[w]],p.index,p.item);break;case"D":delete b[p.path[w]];break;case"E":case"N":b[p.path[w]]=p.rhs;break}}else switch(p.kind){case"A":C(g[m],p.index,p.item);break;case"D":g=a(g,m);break;case"E":case"N":g[m]=p.rhs;break}return g}function D(g,m,p){if(typeof p>"u"&&m&&~t.indexOf(m.kind)&&(p=m),g&&p&&p.kind){for(var b=g,w=-1,_=p.path?p.path.length-1:0;++w<_;)typeof b[p.path[w]]>"u"&&(b[p.path[w]]=typeof p.path[w+1]<"u"&&typeof p.path[w+1]=="number"?[]:{}),b=b[p.path[w]];switch(p.kind){case"A":p.path&&typeof b[p.path[w]]>"u"&&(b[p.path[w]]=[]),C(p.path?b[p.path[w]]:b,p.index,p.item);break;case"D":delete b[p.path[w]];break;case"E":case"N":b[p.path[w]]=p.rhs;break}}}function O(g,m,p){if(p.path&&p.path.length){var b=g[m],w,_=p.path.length-1;for(w=0;w<_;w++)b=b[p.path[w]];switch(p.kind){case"A":O(b[p.path[w]],p.index,p.item);break;case"D":b[p.path[w]]=p.lhs;break;case"E":b[p.path[w]]=p.lhs;break;case"N":delete b[p.path[w]];break}}else switch(p.kind){case"A":O(g[m],p.index,p.item);break;case"D":g[m]=p.lhs;break;case"E":g[m]=p.lhs;break;case"N":g=a(g,m);break}return g}function Vr(g,m,p){if(g&&m&&p&&p.kind){var b=g,w,_;for(_=p.path.length-1,w=0;w<_;w++)typeof b[p.path[w]]>"u"&&(b[p.path[w]]={}),b=b[p.path[w]];switch(p.kind){case"A":O(b[p.path[w]],p.index,p.item);break;case"D":b[p.path[w]]=p.lhs;break;case"E":b[p.path[w]]=p.lhs;break;case"N":delete b[p.path[w]];break}}}function te(g,m,p){if(g&&m){var b=function(w){(!p||p(g,m,w))&&D(g,m,w)};f(g,m,b)}}return Object.defineProperties(x,{diff:{value:x,enumerable:!0},orderIndependentDiff:{value:U,enumerable:!0},observableDiff:{value:f,enumerable:!0},orderIndependentObservableDiff:{value:y,enumerable:!0},orderIndepHash:{value:u,enumerable:!0},applyDiff:{value:te,enumerable:!0},applyChange:{value:D,enumerable:!0},revertChange:{value:Vr,enumerable:!0},isConflict:{value:function(){return typeof $conflict<"u"},enumerable:!0}}),x.DeepDiff=x,e&&(e.DeepDiff=x),x})});var Xo=typeof btoa=="function",Pn=typeof Buffer=="function",za=typeof TextDecoder=="function"?new TextDecoder:void 0,Pr=typeof TextEncoder=="function"?new TextEncoder:void 0,Qo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Se=Array.prototype.slice.call(Qo),qa=(e=>{let t={};return e.forEach((n,r)=>t[n]=r),t})(Se);var it=String.fromCharCode.bind(String),Ha=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),ti=e=>e.replace(/=/g,"").replace(/[+\/]/g,t=>t=="+"?"-":"_");var ei=e=>{let t,n,r,s,o="",i=e.length%3;for(let c=0;c<e.length;){if((n=e.charCodeAt(c++))>255||(r=e.charCodeAt(c++))>255||(s=e.charCodeAt(c++))>255)throw new TypeError("invalid character found");t=n<<16|r<<8|s,o+=Se[t>>18&63]+Se[t>>12&63]+Se[t>>6&63]+Se[t&63]}return i?o.slice(0,i-3)+"===".substring(i):o},qr=Xo?e=>btoa(e):Pn?e=>Buffer.from(e,"binary").toString("base64"):ei,ni=Pn?e=>Buffer.from(e).toString("base64"):e=>{let n=[];for(let r=0,s=e.length;r<s;r+=4096)n.push(it.apply(null,e.subarray(r,r+4096)));return qr(n.join(""))};var ri=e=>{if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?it(192|t>>>6)+it(128|t&63):it(224|t>>>12&15)+it(128|t>>>6&63)+it(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return it(240|t>>>18&7)+it(128|t>>>12&63)+it(128|t>>>6&63)+it(128|t&63)}},si=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,oi=e=>e.replace(si,ri),zr=Pn?e=>Buffer.from(e,"utf8").toString("base64"):Pr?e=>ni(Pr.encode(e)):e=>qr(oi(e)),zn=(e,t=!1)=>t?ti(zr(e)):zr(e);var Hr=(e,t="_")=>e.replace(/[\W]+/g,t);var Jr=e=>JSON.parse(JSON.stringify(e));var ii=()=>String(Math.random())+"-"+Date.now().toFixed();var ke=(e,t)=>new Promise((n,r)=>{if(t&&globalThis[t])return n(globalThis[t]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(e),t&&globalThis[t]?n(globalThis[t]):n(globalThis);let s=document.createElement("script");s.src=e,s.async=!0;let o=()=>{s.removeEventListener("load",i),s.removeEventListener("error",c)},i=()=>{if(o(),!t)return n("loaded: "+e);let a=setInterval(()=>{if(window[t])return clearInterval(a),n(window[t])},5)},c=()=>{o(),r("failed to load: "+e)};s.addEventListener("load",i),s.addEventListener("error",c),document.head.appendChild(s)});var Gr=e=>{let n=[];for(let r=0;r<e.length;r+=32768)n.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(n.join(""))};var qn=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0};var Hn=async(e,t)=>new Promise(n=>{let r=ii(),s=o=>{let i=o.data;i.method===t.method&&i.messageId===r&&(e.removeEventListener("message",s),n(i.data))};e.addEventListener("message",s),e.postMessage({...t,messageId:r})});var Kr=["esm.sh","skypack","jspm"],Zr=["unpkg","jsdelivr","fastly.jsdelivr"],Yr=["fastly.jsdelivr.gh","jsdelivr.gh","statically"],Mt={getModuleUrl:(e,{isModule:t=!0,defaultCDN:n="esm.sh"}={})=>{e=e.replace(/#nobundle/g,"");let r=Wr(e,t,n);return r||(t?"https://esm.sh/"+e:"https://cdn.jsdelivr.net/npm/"+e)},getUrl:(e,t)=>e.startsWith("http")||e.startsWith("data:")?e:Wr(e,!1,t||ci())||e,cdnLists:{npm:Zr,module:Kr,gh:Yr},checkCDNs:async(e,t)=>{let n=[t,...Mt.cdnLists.npm].filter(Boolean);for(let r of n)try{if((await fetch(Mt.getUrl(e,r),{method:"HEAD"})).ok)return r}catch{}return Mt.cdnLists.npm[0]}},ci=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||Mt.cdnLists.npm[0]}catch{return Mt.cdnLists.npm[0]}},Wr=(e,t,n)=>{let r=t&&e.startsWith("unpkg:")?"?module":"";e.startsWith("gh:")?e=e.replace("gh",Yr[0]):e.includes(":")||(e=(n||(t?Kr[0]:Zr[0]))+":"+e);for(let s of ai){let[o,i]=s;if(o.test(e))return e.replace(o,i)+r}return null},ai=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly.jsdelivr.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:Jn,getModuleUrl:tl}=Mt;var Gn=Jn("jszip@3.10.1/dist/jszip.js");var Xr=Jn("localforage@1.10.0/dist/localforage.js");var li="0.6.64",el=Jn(`malinajs@${li}/malina.js`);var We=()=>{let e=[];return{subscribe:o=>(e.push(o),{unsubscribe:()=>{e.splice(e.indexOf(o),1)}}),notify:o=>{e.forEach(i=>{i(o)})},hasSubscribers:()=>e.length>0,unsubscribeAll:()=>{e.length=0}}};var Qr={getList:async()=>[],getAllData:async()=>[],getItem:async()=>null,addItem:async()=>"",updateItem:async()=>"",deleteItem:async()=>{},bulkInsert:async()=>{},restore:async()=>{},clear:async()=>{},subscribe:()=>({unsubscribe:()=>{}}),unsubscribeAll:()=>{}},ts={getValue:()=>null,setValue:()=>{},clear:()=>{},subscribe:()=>({unsubscribe:()=>{}}),unsubscribeAll:()=>{}};var Ke,es="livecodes",Wn={},Kn=()=>(Date.now()+""+Math.floor(Math.floor(Math.random()*Date.now()))).substring(0,24),di=async e=>{Ke||(Ke=await ke(Xr,"localforage"),Ke.config({name:es})),Wn[e]||(Wn[e]=Ke.createInstance({name:es,storeName:e}))},Vt=async(e,t)=>{if(t)return Qr;let n,r=We(),s=C=>r.subscribe(C),o=()=>{r.unsubscribeAll()},i=()=>{r.hasSubscribers()&&l().then(C=>{r.notify(C)})},c=async()=>{await di(e),n=Wn[e]},a=async()=>(await c(),n.keys()),l=async()=>{await c();let C=[];return await n.iterate(D=>{C.push(D)}),C.sort((D,O)=>O.lastModified&&D.lastModified?O.lastModified-D.lastModified:0)},d=async C=>(await c(),n.getItem(C)),u=async(C,D,O=!0)=>(await c(),await n.setItem(C,D),O&&i(),C),h=async(C,D=!0)=>{let O=Kn();return await u(O,C,D),O};return{getList:a,getAllData:l,getItem:d,addItem:C=>h(C),updateItem:(C,D)=>u(C,D),deleteItem:async C=>{await c(),await n.removeItem(C),i()},bulkInsert:async C=>{for(let D of C)await h(D,!1);i()},restore:async C=>{for(let D of C)D.id?await u(D.id,D,!1):await h(D,!1);i()},clear:async()=>{await c(),await n.clear(),i()},subscribe:s,unsubscribeAll:o}};var Zn=async(e,t)=>{let n=await Vt(e,t),r=async()=>(await n.getAllData()).map(c=>({id:c.id,title:c.config?.title||"",description:c.config?.description||"",tags:c.config?.tags||[],languages:c.config?[c.config.markup.language,c.config.style.language,c.config.script.language]:[],lastModified:c.lastModified})).sort((c,a)=>a.lastModified-c.lastModified),s=(c,a)=>{let l={id:c,config:a,lastModified:Date.now()};return n.updateItem(c,l)},o=async c=>{let a=Kn();return s(a,c)};return{...n,getList:r,addItem:o,updateItem:s,bulkInsert:async c=>{for(let a of c)await o(a)}}};var Ze=(e,t)=>{if(t)return ts;let n=We(),r=l=>n.subscribe(l),s=()=>{n.unsubscribeAll()},o=()=>{n.notify(c())},i=l=>{window.localStorage.setItem(e,JSON.stringify(l)),o()},c=()=>{let l=window.localStorage.getItem(e);if(!l)return null;try{return JSON.parse(l)}catch{return null}};return{getValue:c,setValue:i,clear:()=>{i(null),o()},subscribe:r,unsubscribeAll:s}};var ns=()=>Jr({projects:null,templates:null,assets:null,snippets:null,recover:null,userConfig:null,userData:null,appData:null,sync:null}),rs=async(e,t)=>{t||(e.projects=await Zn("__livecodes_data__",t),e.templates=await Zn("__livecodes_templates__",t),e.assets=await Vt("__livecodes_assets__",t),e.snippets=await Vt("__livecodes_snippets__",t),e.recover=Ze("__livecodes_project_recover__",t),e.userConfig=Ze("__livecodes_user_config__",t),e.userData=await Vt("__livecodes_user_data__",t),e.appData=Ze("__livecodes_app_data__",t),e.sync=await Vt("__livecodes_sync_data__",t))};var Yn=(e,t)=>{for(let n of Object.keys(t))if(t[n]===e)return n;return null};var ee=(e,t)=>({Accept:`application/vnd.github.v3${t?"."+t:""}+json`,"Content-Type":"application/json",Authorization:"token "+e.token}),ui=async(e,t)=>{try{return(await fetch(`https://api.github.com/repos/${e.username}/${t}`,{method:"GET",cache:"no-store",headers:ee(e)})).ok}catch{return!1}},hi=async(e,t,n=!1,r)=>{let s=await fetch("https://api.github.com/user/repos",{method:"POST",cache:"no-store",headers:ee(e),body:JSON.stringify({name:t,private:n,...n?{}:{homepage:`https://${e.username}.github.io/${t}/`},...r?{description:r}:{}})});if(!s.ok)throw await s.json().then(i=>i.errors[0]?.message)==="name already exists on this account"?new Error("Repo name already exists"):new Error("Error creating repo");return s.json().then(o=>o.name)},ss=async({user:e,repo:t,branch:n,file:r,message:s,initialize:o=!1,encoded:i=!1})=>{let c=`https://api.github.com/repos/${e.username}/${t}/contents/`,a=r.path.split("/").slice(0,-1).join("/"),l;if(!o){let u=await fetch(c+a,{method:"GET",cache:"no-store",headers:ee(e)});u.ok&&(l=(await u.json()).find(f=>f.path===r.path)?.sha)}let d=await fetch(c+r.path,{method:"PUT",cache:"no-store",headers:ee(e),body:JSON.stringify({message:s||"deploy",content:i?r.content:zn(r.content),branch:n,...l?{sha:l}:{}})});if(!d.ok)throw new Error("Error creating file");return d.json()},Ue=async({user:e,repo:t,branch:n,path:r})=>{let s=`https://api.github.com/repos/${e.username}/${t}/contents/${r}`+(n?`?ref=${n}`:""),o=await fetch(s,{method:"GET",cache:"no-store",headers:ee(e,"object")});if(!o.ok)throw new Error("Error getting file");let i=await o.json();if(i.content===""&&i.encoding==="none"){let c=await fetch(s,{method:"GET",cache:"no-store",headers:ee(e,"raw")});if(!c.ok)throw new Error("Error getting file");r.endsWith(".b64.zip")?(i.content=await c.arrayBuffer(),i.encoding="arrayBuffer"):(i.content=zn(await c.text()),i.encoding="base64")}return i},fi=async(e,t,n="main",r)=>(await ss({user:e,repo:t,branch:n,file:{path:"README.md",content:`${r||"# "+t+`
`}`},message:"initial commit",initialize:!0,encoded:!1}))?.commit.sha;var Xn=async({file:e,user:t,repo:n,branch:r,message:s,newRepo:o,privateRepo:i,description:c,readmeContent:a})=>{try{(o||!await ui(t,n))&&(o=!0,n=Hr(n,"-").toLowerCase(),await hi(t,n,i,c),await fi(t,n,r,a));let l=await ss({user:t,repo:n,branch:r,file:e,message:s,initialize:o||!1,encoded:!0});return{tree:l?.commit?.tree?.sha,commit:l?.commit?.sha}}catch{return null}};var F={};Ko(F,{AbsolutePosition:()=>xn,AbstractConnector:()=>hr,AbstractStruct:()=>ge,AbstractType:()=>L,Array:()=>M,ContentAny:()=>pt,ContentBinary:()=>Lt,ContentDeleted:()=>Bt,ContentEmbed:()=>ft,ContentFormat:()=>B,ContentJSON:()=>Qt,ContentString:()=>Z,ContentType:()=>Y,Doc:()=>wt,GC:()=>P,ID:()=>yt,Item:()=>A,Map:()=>q,PermanentUserData:()=>pr,RelativePosition:()=>pe,Snapshot:()=>Re,Text:()=>St,Transaction:()=>kn,UndoManager:()=>yr,UpdateEncoderV1:()=>bt,XmlElement:()=>jt,XmlFragment:()=>ht,XmlHook:()=>Zt,XmlText:()=>Yt,YArrayEvent:()=>Cn,YEvent:()=>Kt,YMapEvent:()=>En,YTextEvent:()=>_n,YXmlEvent:()=>An,applyUpdate:()=>yc,applyUpdateV2:()=>In,cleanupYTextFormatting:()=>Io,compareIDs:()=>Gt,compareRelativePositions:()=>Lc,convertUpdateFormatV1ToV2:()=>Zc,convertUpdateFormatV2ToV1:()=>go,createAbsolutePositionFromRelativePosition:()=>jc,createDeleteSet:()=>Tn,createDeleteSetFromStructStore:()=>kr,createDocFromSnapshot:()=>Rc,createID:()=>k,createRelativePositionFromJSON:()=>Cc,createRelativePositionFromTypeIndex:()=>_c,createSnapshot:()=>Ar,decodeRelativePosition:()=>Ic,decodeSnapshot:()=>Nc,decodeSnapshotV2:()=>eo,decodeStateVector:()=>Cr,decodeUpdate:()=>Hc,decodeUpdateV2:()=>ao,diffUpdate:()=>Kc,diffUpdateV2:()=>Dr,emptySnapshot:()=>Mc,encodeRelativePosition:()=>Dc,encodeSnapshot:()=>Oc,encodeSnapshotV2:()=>to,encodeStateAsUpdate:()=>bc,encodeStateAsUpdateV2:()=>Ys,encodeStateVector:()=>kc,encodeStateVectorFromUpdate:()=>Jc,encodeStateVectorFromUpdateV2:()=>uo,equalSnapshots:()=>Bc,findIndexSS:()=>et,findRootTypeKey:()=>_r,getItem:()=>Le,getState:()=>I,getTypeChildren:()=>ta,isDeleted:()=>me,isParentOf:()=>Ve,iterateDeletedStructs:()=>Dt,logType:()=>Uc,logUpdate:()=>qc,logUpdateV2:()=>co,mergeUpdates:()=>lo,mergeUpdatesV2:()=>$e,parseUpdateMeta:()=>Gc,parseUpdateMetaV2:()=>ho,readUpdate:()=>mc,readUpdateV2:()=>vr,relativePositionToJSON:()=>vc,snapshot:()=>Vc,transact:()=>T,tryGc:()=>Pc,typeListToArraySnapshot:()=>ea,typeMapGetSnapshot:()=>sa});var H=()=>new Map,ve=e=>{let t=H();return e.forEach((n,r)=>{t.set(r,n)}),t},ct=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},os=(e,t)=>{let n=[];for(let[r,s]of e)n.push(t(s,r));return n},is=(e,t)=>{for(let[n,r]of e)if(t(r,n))return!0;return!1};var Rt=()=>new Set;var Ye=e=>e[e.length-1];var as=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Xe=Array.from;var Qn=Array.isArray;var ne=class{constructor(){this._observers=H()}on(t,n){ct(this._observers,t,Rt).add(n)}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Xe((this._observers.get(t)||H()).values()).forEach(r=>r(...n))}destroy(){this._observers=H()}};var re=Math.floor;var se=Math.abs;var Qe=(e,t)=>e<t?e:t,mt=(e,t)=>e>t?e:t,Tl=Number.isNaN;var tn=e=>e!==0?e<0:1/e<0;var Il=String.fromCharCode,jl=String.fromCodePoint,pi=e=>e.toLowerCase(),gi=/^\s*/g,mi=e=>e.replace(gi,""),yi=/([A-Z])/g,er=(e,t)=>mi(e.replace(yi,n=>`${t}${pi(n)}`));var Ll=typeof TextEncoder<"u"?new TextEncoder:null;var tr=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});tr&&tr.decode(new Uint8Array).length===1&&(tr=null);var nr=e=>e===void 0?null:e;var rr=class{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}},ds=new rr,xi=!0;try{typeof localStorage<"u"&&(ds=localStorage,xi=!1)}catch{}var us=ds;var nn=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);var Bl=typeof navigator<"u"?/Mac/.test(navigator.platform):!1,at,ki=[],Ui=()=>{if(at===void 0)if(nn){at=H();let e=process.argv,t=null;for(let n=0;n<e.length;n++){let r=e[n];r[0]==="-"?(t!==null&&at.set(t,""),t=r):t!==null?(at.set(t,r),t=null):ki.push(r)}t!==null&&at.set(t,"")}else typeof location=="object"?(at=H(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){let[t,n]=e.split("=");at.set(`--${er(t,"-")}`,n),at.set(`-${er(t,"-")}`,n)}})):at=H();return at},vi=e=>Ui().has(e);var hs=e=>nn?nr(process.env[e.toUpperCase()]):nr(us.getItem(e));var Ci=e=>vi("--"+e)||hs(e)!==null,Ol=Ci("production");var oe=class{constructor(t){this.arr=t,this.pos=0}},R=e=>new oe(e),sr=e=>e.pos!==e.arr.length;var _i=(e,t)=>{let n=Ae(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},J=e=>_i(e,v(e));var Ft=e=>e.arr[e.pos++];var v=e=>{let t=0,n=0;for(;;){let r=e.arr[e.pos++];if(t=t|(r&127)<<n,n+=7,r<128)return t>>>0;if(n>53)throw new Error("Integer out of range!")}},_e=e=>{let t=e.arr[e.pos++],n=t&63,r=6,s=(t&64)>0?-1:1;if(!(t&128))return s*n;for(;;){if(t=e.arr[e.pos++],n=n|(t&127)<<r,r+=7,t<128)return s*(n>>>0);if(r>53)throw new Error("Integer out of range!")}};var Ut=e=>{let t=v(e);if(t===0)return"";{let n=String.fromCodePoint(Ft(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ft(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}};var or=(e,t)=>{let n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Ai=e=>or(e,4).getFloat32(0,!1),Di=e=>or(e,8).getFloat64(0,!1),Ti=e=>or(e,8).getBigInt64(0,!1);var Ii=[e=>{},e=>null,_e,Ai,Di,Ti,e=>!1,e=>!0,Ut,e=>{let t=v(e),n={};for(let r=0;r<t;r++){let s=Ut(e);n[s]=ie(e)}return n},e=>{let t=v(e),n=[];for(let r=0;r<t;r++)n.push(ie(e));return n},J],ie=e=>Ii[127-Ft(e)](e),Ee=class extends oe{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),sr(this)?this.count=v(this)+1:this.count=-1),this.count--,this.s}};var $t=class extends oe{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=_e(this);let t=tn(this.s);this.count=1,t&&(this.s=-this.s,this.count=v(this)+2)}return this.count--,this.s}};var ce=class extends oe{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let t=_e(this),n=t&1;this.diff=t>>1,this.count=1,n&&(this.count=v(this)+2)}return this.s+=this.diff,this.count--,this.s}},rn=class{constructor(t){this.decoder=new $t(t),this.str=Ut(this.decoder),this.spos=0}read(){let t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}};var Li=e=>new Uint8Array(e),Ae=(e,t,n)=>new Uint8Array(e,t,n);var ps=e=>{let t=Li(e.byteLength);return t.set(e),t};var Nl=Number.MAX_SAFE_INTEGER,Ml=Number.MIN_SAFE_INTEGER,Vl=1<<31;var gs=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&re(e)===e),Rl=Number.isNaN,Fl=Number.parseInt;var Pt=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},qt=()=>new Pt,Oi=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},G=e=>{let t=new Uint8Array(Oi(e)),n=0;for(let r=0;r<e.bufs.length;r++){let s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(Ae(e.cbuf.buffer,0,e.cpos),n),t},Ni=(e,t)=>{let n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(Ae(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(mt(n,t)*2),e.cpos=0)},N=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t};var ue=N;var S=(e,t)=>{for(;t>127;)N(e,128|127&t),t>>>=7;N(e,127&t)},Te=(e,t)=>{let n=tn(t);for(n&&(t=-t),N(e,(t>63?128:0)|(n?64:0)|63&t),t>>>=6;t>0;)N(e,(t>127?128:0)|127&t),t>>>=7},Ct=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;S(e,r);for(let s=0;s<r;s++)N(e,n.codePointAt(s))},bs=(e,t)=>he(e,G(t)),he=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=Qe(n-r,t.length),o=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(mt(n*2,o)),e.cbuf.set(t.subarray(s)),e.cpos=o)},W=(e,t)=>{S(e,t.byteLength),he(e,t)},cr=(e,t)=>{Ni(e,t);let n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Mi=(e,t)=>cr(e,4).setFloat32(0,t,!1),Vi=(e,t)=>cr(e,8).setFloat64(0,t,!1),Ri=(e,t)=>cr(e,8).setBigInt64(0,t,!1);var ms=new DataView(new ArrayBuffer(4)),Fi=e=>(ms.setFloat32(0,e),ms.getFloat32(0)===e),le=(e,t)=>{switch(typeof t){case"string":N(e,119),Ct(e,t);break;case"number":gs(t)&&se(t)<=2147483647?(N(e,125),Te(e,t)):Fi(t)?(N(e,124),Mi(e,t)):(N(e,123),Vi(e,t));break;case"bigint":N(e,122),Ri(e,t);break;case"object":if(t===null)N(e,126);else if(t instanceof Array){N(e,117),S(e,t.length);for(let n=0;n<t.length;n++)le(e,t[n])}else if(t instanceof Uint8Array)N(e,116),W(e,t);else{N(e,118);let n=Object.keys(t);S(e,n.length);for(let r=0;r<n.length;r++){let s=n[r];Ct(e,s),le(e,t[s])}}break;case"boolean":N(e,t?120:121);break;default:N(e,127)}},De=class extends Pt{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&S(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}};var ys=e=>{e.count>0&&(Te(e.encoder,e.count===1?e.s:-e.s),e.count>1&&S(e.encoder,e.count-2))},zt=class{constructor(){this.encoder=new Pt,this.s=0,this.count=0}write(t){this.s===t?this.count++:(ys(this),this.count=1,this.s=t)}toUint8Array(){return ys(this),G(this.encoder)}};var ws=e=>{if(e.count>0){let t=e.diff<<1|(e.count===1?0:1);Te(e.encoder,t),e.count>1&&S(e.encoder,e.count-2)}},de=class{constructor(){this.encoder=new Pt,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(ws(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return ws(this),G(this.encoder)}},sn=class{constructor(){this.sarr=[],this.s="",this.lensE=new zt}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){let t=new Pt;return this.sarr.push(this.s),this.s="",Ct(t,this.sarr.join("")),he(t,this.lensE.toUint8Array()),G(t)}};var Pi=typeof window>"u"?null:typeof window.performance<"u"&&window.performance||null,xs=typeof crypto>"u"?null:crypto,ar=xs!==null?e=>{let t=new ArrayBuffer(e),n=new Uint8Array(t);return xs.getRandomValues(n),t}:e=>{let t=new ArrayBuffer(e),n=new Uint8Array(t);for(let r=0;r<e;r++)n[r]=Math.ceil(Math.random()*4294967295>>>0);return t};var lr=()=>new Uint32Array(ar(4))[0];var zi=[1e7]+-1e3+-4e3+-8e3+-1e11,Ss=()=>zi.replace(/[018]/g,e=>(e^lr()&15>>e/4).toString(16));var on=Date.now;var Us=e=>new Promise(e);var Ie=e=>new Error(e),rt=()=>{throw Ie("Method unimplemented")},K=()=>{throw Ie("Unexpected case")};var Gi=Object.keys;var vs=e=>Gi(e).length;var Wi=(e,t)=>{for(let n in e)if(!t(e[n],n))return!1;return!0},Ki=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Cs=(e,t)=>e===t||vs(e)===vs(t)&&Wi(e,(n,r)=>(n!==void 0||Ki(t,r))&&t[r]===n);var je=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&je(e,t,n+1)}};var lt=Symbol;var dr=class{constructor(t,n){this.left=t,this.right=n}},dt=(e,t)=>new dr(e,t);var Ht=typeof document<"u"?document:{};var Jl=typeof DOMParser<"u"?new DOMParser:null;var Es=e=>os(e,(t,n)=>`${n}:${t};`).join("");var Gl=Ht.ELEMENT_NODE,Wl=Ht.TEXT_NODE,Kl=Ht.CDATA_SECTION_NODE,Zl=Ht.COMMENT_NODE,Yl=Ht.DOCUMENT_NODE,Xl=Ht.DOCUMENT_TYPE_NODE,Ql=Ht.DOCUMENT_FRAGMENT_NODE;var cn=lt(),an=lt(),_s=lt(),As=lt(),Ds=lt(),ln=lt(),Ts=lt(),dn=lt(),Is=lt(),ec={[cn]:dt("font-weight","bold"),[an]:dt("font-weight","normal"),[_s]:dt("color","blue"),[Ds]:dt("color","green"),[As]:dt("color","grey"),[ln]:dt("color","red"),[Ts]:dt("color","purple"),[dn]:dt("color","orange"),[Is]:dt("color","black")},nc={[cn]:"\x1B[1m",[an]:"\x1B[2m",[_s]:"\x1B[34m",[Ds]:"\x1B[32m",[As]:"\x1B[37m",[ln]:"\x1B[31m",[Ts]:"\x1B[35m",[dn]:"\x1B[38;5;208m",[Is]:"\x1B[0m"},rc=e=>{let t=[],n=[],r=H(),s=[],o=0;for(;o<e.length;o++){let i=e[o],c=ec[i];if(c!==void 0)r.set(c.left,c.right);else if(i.constructor===String||i.constructor===Number){let a=Es(r);o>0||a.length>0?(t.push("%c"+i),n.push(a)):t.push(i)}else break}for(o>0&&(s=n,s.unshift(t.join("")));o<e.length;o++){let i=e[o];i instanceof Symbol||s.push(i)}return s},sc=e=>{let t=[],n=[],r=0;for(;r<e.length;r++){let s=e[r],o=nc[s];if(o!==void 0)t.push(o);else if(s.constructor===String||s.constructor===Number)t.push(s);else break}for(r>0&&(t.push("\x1B[0m"),n.push(t.join("")));r<e.length;r++){let s=e[r];s instanceof Symbol||n.push(s)}return n},oc=nn?sc:rc,un=(...e)=>{console.log(...oc(e)),ic.forEach(t=>t.print(e))};var ic=new Set;var od=on();var js=e=>({[Symbol.iterator](){return this},next:e}),Ls=(e,t)=>js(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),hn=(e,t)=>js(()=>{let{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});var hr=class extends ne{constructor(t,n){super(),this.doc=t,this.awareness=n}},Oe=class{constructor(t,n){this.clock=t,this.len=n}},At=class{constructor(){this.clients=new Map}},Dt=(e,t,n)=>t.clients.forEach((r,s)=>{let o=e.doc.store.clients.get(s);for(let i=0;i<r.length;i++){let c=r[i];ro(e,o,c.clock,c.len,n)}}),uc=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){let s=re((n+r)/2),o=e[s],i=o.clock;if(i<=t){if(t<i+o.len)return s;n=s+1}else r=s-1}return null},me=(e,t)=>{let n=e.clients.get(t.client);return n!==void 0&&uc(n,t.clock)!==null},Sr=e=>{e.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){let s=t[r-1],o=t[n];s.clock+s.len>=o.clock?s.len=mt(s.len,o.clock+o.len-s.clock):(r<n&&(t[r]=o),r++)}t.length=r})},Ne=e=>{let t=new At;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){let o=r.slice();for(let i=n+1;i<e.length;i++)as(o,e[i].clients.get(s)||[]);t.clients.set(s,o)}});return Sr(t),t},Me=(e,t,n,r)=>{ct(e.clients,t,()=>[]).push(new Oe(n,r))},Tn=()=>new At,kr=e=>{let t=Tn();return e.clients.forEach((n,r)=>{let s=[];for(let o=0;o<n.length;o++){let i=n[o];if(i.deleted){let c=i.id.clock,a=i.length;if(o+1<n.length)for(let l=n[o+1];o+1<n.length&&l.deleted;l=n[++o+1])a+=l.length;s.push(new Oe(c,a))}}s.length>0&&t.clients.set(r,s)}),t},ut=(e,t)=>{S(e.restEncoder,t.clients.size),t.clients.forEach((n,r)=>{e.resetDsCurVal(),S(e.restEncoder,r);let s=n.length;S(e.restEncoder,s);for(let o=0;o<s;o++){let i=n[o];e.writeDsClock(i.clock),e.writeDsLen(i.len)}})},Tt=e=>{let t=new At,n=v(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();let s=v(e.restDecoder),o=v(e.restDecoder);if(o>0){let i=ct(t.clients,s,()=>[]);for(let c=0;c<o;c++)i.push(new Oe(e.readDsClock(),e.readDsLen()))}}return t},Ns=(e,t,n)=>{let r=new At,s=v(e.restDecoder);for(let o=0;o<s;o++){e.resetDsCurVal();let i=v(e.restDecoder),c=v(e.restDecoder),a=n.clients.get(i)||[],l=I(n,i);for(let d=0;d<c;d++){let u=e.readDsClock(),h=u+e.readDsLen();if(u<l){l<h&&Me(r,i,l,h-l);let f=et(a,u),y=a[f];for(!y.deleted&&y.id.clock<u&&(a.splice(f+1,0,Dn(t,y,u-y.id.clock)),f++);f<a.length&&(y=a[f++],y.id.clock<h);)y.deleted||(h<y.id.clock+y.length&&a.splice(f,0,Dn(t,y,h-y.id.clock)),y.delete(t))}else Me(r,i,u,h-u)}}if(r.clients.size>0){let o=new ot;return S(o.restEncoder,0),ut(o,r),o.toUint8Array()}return null},Zs=lr,wt=class extends ne{constructor({guid:t=Ss(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:i=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=Zs(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Sn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=i,this.meta=o,this.isLoaded=!1,this.whenLoaded=Us(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})})}load(){let t=this._item;t!==null&&!this.shouldLoad&&T(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,n=null){T(this,t,n)}get(t,n=L){let r=ct(this.share,t,()=>{let o=new n;return o._integrate(this,null),o}),s=r.constructor;if(n!==L&&s!==n)if(s===L){let o=new n;o._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=o}),o._start=r._start;for(let i=o._start;i!==null;i=i.right)i.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,M)}getText(t=""){return this.get(t,St)}getMap(t=""){return this.get(t,q)}getXmlFragment(t=""){return this.get(t,ht)}toJSON(){let t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){Xe(this.subdocs).forEach(n=>n.destroy());let t=this._item;if(t!==null){this._item=null;let n=t.content;n.doc=new wt({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,T(t.parent.doc,r=>{let s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}},Wt=class{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return v(this.restDecoder)}readDsLen(){return v(this.restDecoder)}},st=class extends Wt{readLeftID(){return k(v(this.restDecoder),v(this.restDecoder))}readRightID(){return k(v(this.restDecoder),v(this.restDecoder))}readClient(){return v(this.restDecoder)}readInfo(){return Ft(this.restDecoder)}readString(){return Ut(this.restDecoder)}readParentInfo(){return v(this.restDecoder)===1}readTypeRef(){return v(this.restDecoder)}readLen(){return v(this.restDecoder)}readAny(){return ie(this.restDecoder)}readBuf(){return ps(J(this.restDecoder))}readJSON(){return JSON.parse(Ut(this.restDecoder))}readKey(){return Ut(this.restDecoder)}},bn=class{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=v(this.restDecoder),this.dsCurrVal}readDsLen(){let t=v(this.restDecoder)+1;return this.dsCurrVal+=t,t}},tt=class extends bn{constructor(t){super(t),this.keys=[],v(t),this.keyClockDecoder=new ce(J(t)),this.clientDecoder=new $t(J(t)),this.leftClockDecoder=new ce(J(t)),this.rightClockDecoder=new ce(J(t)),this.infoDecoder=new Ee(J(t),Ft),this.stringDecoder=new rn(J(t)),this.parentInfoDecoder=new Ee(J(t),Ft),this.typeRefDecoder=new $t(J(t)),this.lenDecoder=new $t(J(t))}readLeftID(){return new yt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new yt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ie(this.restDecoder)}readBuf(){return J(this.restDecoder)}readJSON(){return ie(this.restDecoder)}readKey(){let t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{let n=this.stringDecoder.read();return this.keys.push(n),n}}},It=class{constructor(){this.restEncoder=qt()}toUint8Array(){return G(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){S(this.restEncoder,t)}writeDsLen(t){S(this.restEncoder,t)}},bt=class extends It{writeLeftID(t){S(this.restEncoder,t.client),S(this.restEncoder,t.clock)}writeRightID(t){S(this.restEncoder,t.client),S(this.restEncoder,t.clock)}writeClient(t){S(this.restEncoder,t)}writeInfo(t){ue(this.restEncoder,t)}writeString(t){Ct(this.restEncoder,t)}writeParentInfo(t){S(this.restEncoder,t?1:0)}writeTypeRef(t){S(this.restEncoder,t)}writeLen(t){S(this.restEncoder,t)}writeAny(t){le(this.restEncoder,t)}writeBuf(t){W(this.restEncoder,t)}writeJSON(t){Ct(this.restEncoder,JSON.stringify(t))}writeKey(t){Ct(this.restEncoder,t)}},fe=class{constructor(){this.restEncoder=qt(),this.dsCurrVal=0}toUint8Array(){return G(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){let n=t-this.dsCurrVal;this.dsCurrVal=t,S(this.restEncoder,n)}writeDsLen(t){t===0&&K(),S(this.restEncoder,t-1),this.dsCurrVal+=t}},ot=class extends fe{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new de,this.clientEncoder=new zt,this.leftClockEncoder=new de,this.rightClockEncoder=new de,this.infoEncoder=new De(ue),this.stringEncoder=new sn,this.parentInfoEncoder=new De(ue),this.typeRefEncoder=new zt,this.lenEncoder=new zt}toUint8Array(){let t=qt();return S(t,0),W(t,this.keyClockEncoder.toUint8Array()),W(t,this.clientEncoder.toUint8Array()),W(t,this.leftClockEncoder.toUint8Array()),W(t,this.rightClockEncoder.toUint8Array()),W(t,G(this.infoEncoder)),W(t,this.stringEncoder.toUint8Array()),W(t,G(this.parentInfoEncoder)),W(t,this.typeRefEncoder.toUint8Array()),W(t,this.lenEncoder.toUint8Array()),he(t,G(this.restEncoder)),G(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){le(this.restEncoder,t)}writeBuf(t){W(this.restEncoder,t)}writeJSON(t){le(this.restEncoder,t)}writeKey(t){let n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}},hc=(e,t,n,r)=>{r=mt(r,t[0].id.clock);let s=et(t,r);S(e.restEncoder,t.length-s),e.writeClient(n),S(e.restEncoder,r);let o=t[s];o.write(e,r-o.id.clock);for(let i=s+1;i<t.length;i++)t[i].write(e,0)},Ur=(e,t,n)=>{let r=new Map;n.forEach((s,o)=>{I(t,o)>s&&r.set(o,s)}),He(t).forEach((s,o)=>{n.has(o)||r.set(o,0)}),S(e.restEncoder,r.size),Array.from(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{hc(e,t.clients.get(s),s,o)})},fc=(e,t)=>{let n=H(),r=v(e.restDecoder);for(let s=0;s<r;s++){let o=v(e.restDecoder),i=new Array(o),c=e.readClient(),a=v(e.restDecoder);n.set(c,{i:0,refs:i});for(let l=0;l<o;l++){let d=e.readInfo();switch(31&d){case 0:{let u=e.readLen();i[l]=new P(k(c,a),u),a+=u;break}case 10:{let u=v(e.restDecoder);i[l]=new z(k(c,a),u),a+=u;break}default:{let u=(d&192)===0,h=new A(k(c,a),null,(d&128)===128?e.readLeftID():null,null,(d&64)===64?e.readRightID():null,u?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,u&&(d&32)===32?e.readString():null,Bo(e,d));i[l]=h,a+=h.length}}}}return n},pc=(e,t,n)=>{let r=[],s=Array.from(n.keys()).sort((f,y)=>f-y);if(s.length===0)return null;let o=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f},i=o();if(i===null&&r.length===0)return null;let c=new Sn,a=new Map,l=(f,y)=>{let x=a.get(f);(x==null||x>y)&&a.set(f,y)},d=i.refs[i.i++],u=new Map,h=()=>{for(let f of r){let y=f.id.client,x=n.get(y);x?(x.i--,c.clients.set(y,x.refs.slice(x.i)),n.delete(y),x.i=0,x.refs=[]):c.clients.set(y,[f]),s=s.filter(U=>U!==y)}r.length=0};for(;;){if(d.constructor!==z){let y=ct(u,d.id.client,()=>I(t,d.id.client))-d.id.clock;if(y<0)r.push(d),l(d.id.client,d.id.clock-1),h();else{let x=d.getMissing(e,t);if(x!==null){r.push(d);let U=n.get(x)||{refs:[],i:0};if(U.refs.length===U.i)l(x,I(t,x)),h();else{d=U.refs[U.i++];continue}}else(y===0||y<d.length)&&(d.integrate(e,y),u.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(i!==null&&i.i<i.refs.length)d=i.refs[i.i++];else{if(i=o(),i===null)break;d=i.refs[i.i++]}}if(c.clients.size>0){let f=new ot;return Ur(f,c,new Map),S(f.restEncoder,0),{missing:a,update:f.toUint8Array()}}return null},gc=(e,t)=>Ur(e,t.doc.store,t.beforeState),vr=(e,t,n,r=new tt(e))=>T(t,s=>{s.local=!1;let o=!1,i=s.doc,c=i.store,a=fc(r,i),l=pc(s,c,a),d=c.pendingStructs;if(d){for(let[h,f]of d.missing)if(f<I(c,h)){o=!0;break}if(l){for(let[h,f]of l.missing){let y=d.missing.get(h);(y==null||y>f)&&d.missing.set(h,f)}d.update=$e([d.update,l.update])}}else c.pendingStructs=l;let u=Ns(r,s,c);if(c.pendingDs){let h=new tt(R(c.pendingDs));v(h.restDecoder);let f=Ns(h,s,c);u&&f?c.pendingDs=$e([u,f]):c.pendingDs=u||f}else c.pendingDs=u;if(o){let h=c.pendingStructs.update;c.pendingStructs=null,In(s.doc,h)}},n,!1),mc=(e,t,n)=>vr(e,t,n,new st(e)),In=(e,t,n,r=tt)=>{let s=R(t);vr(s,e,n,new r(s))},yc=(e,t,n)=>In(e,t,n,st),wc=(e,t,n=new Map)=>{Ur(e,t.store,n),ut(e,kr(t.store))},Ys=(e,t=new Uint8Array([0]),n=new ot)=>{let r=Cr(t);wc(n,e,r);let s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Dr(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===bt)return lo(s.map((o,i)=>i===0?o:go(o)));if(n.constructor===ot)return $e(s)}return s[0]},bc=(e,t)=>Ys(e,t,new bt),Xs=e=>{let t=new Map,n=v(e.restDecoder);for(let r=0;r<n;r++){let s=v(e.restDecoder),o=v(e.restDecoder);t.set(s,o)}return t},Cr=e=>Xs(new Wt(R(e))),Er=(e,t)=>(S(e.restEncoder,t.size),Array.from(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{S(e.restEncoder,n),S(e.restEncoder,r)}),e),xc=(e,t)=>Er(e,He(t.store)),Sc=(e,t=new fe)=>(e instanceof Map?Er(t,e):xc(t,e),t.toUint8Array()),kc=e=>Sc(e,new It),fr=class{constructor(){this.l=[]}},Ms=()=>new fr,Vs=(e,t)=>e.l.push(t),Rs=(e,t)=>{let n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Qs=(e,t,n)=>je(e.l,[t,n]),yt=class{constructor(t,n){this.client=t,this.clock=n}},Gt=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,k=(e,t)=>new yt(e,t),Fs=(e,t)=>{S(e,t.client),S(e,t.clock)},$s=e=>k(v(e),v(e)),_r=e=>{for(let[t,n]of e.doc.share.entries())if(n===e)return t;throw K()},Ve=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},Uc=e=>{let t=[],n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))},pr=class{constructor(t,n=t.getMap("users")){let r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;let s=(o,i)=>{let c=o.get("ds"),a=o.get("ids"),l=d=>this.clients.set(d,i);c.observe(d=>{d.changes.added.forEach(u=>{u.content.getContent().forEach(h=>{h instanceof Uint8Array&&this.dss.set(i,Ne([this.dss.get(i)||Tn(),Tt(new Wt(R(h)))]))})})}),this.dss.set(i,Ne(c.map(d=>Tt(new Wt(R(d)))))),a.observe(d=>d.changes.added.forEach(u=>u.content.getContent().forEach(l))),a.forEach(l)};n.observe(o=>{o.keysChanged.forEach(i=>s(n.get(i),i))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){let o=this.yusers,i=o.get(r);i||(i=new q,i.set("ids",new M),i.set("ds",new M),o.set(r,i)),i.get("ids").push([n]),o.observe(c=>{setTimeout(()=>{let a=o.get(r);if(a!==i){i=a,this.clients.forEach((u,h)=>{r===u&&i.get("ids").push([h])});let l=new It,d=this.dss.get(r);d&&(ut(l,d),i.get("ds").push([l.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{let a=i.get("ds"),l=c.deleteSet;if(c.local&&l.clients.size>0&&s(c,l)){let d=new It;ut(d,l),a.push([d.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(let[n,r]of this.dss.entries())if(me(r,t))return n;return null}},pe=class{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}},vc=e=>{let t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},Cc=e=>new pe(e.type==null?null:k(e.type.client,e.type.clock),e.tname||null,e.item==null?null:k(e.item.client,e.item.clock),e.assoc==null?0:e.assoc),xn=class{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}},Ec=(e,t,n=0)=>new xn(e,t,n),fn=(e,t,n)=>{let r=null,s=null;return e._item===null?s=_r(e):r=k(e._item.id.client,e._item.id.clock),new pe(r,s,t,n)},_c=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return fn(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return fn(e,k(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return fn(e,r.lastId,n);r=r.right}return fn(e,null,n)},Ac=(e,t)=>{let{type:n,tname:r,item:s,assoc:o}=t;if(s!==null)S(e,0),Fs(e,s);else if(r!==null)ue(e,1),Ct(e,r);else if(n!==null)ue(e,2),Fs(e,n);else throw K();return Te(e,o),e},Dc=e=>{let t=qt();return Ac(t,e),G(t)},Tc=e=>{let t=null,n=null,r=null;switch(v(e)){case 0:r=$s(e);break;case 1:n=Ut(e);break;case 2:t=$s(e)}let s=sr(e)?_e(e):0;return new pe(t,n,r,s)},Ic=e=>Tc(R(e)),jc=(e,t)=>{let n=t.store,r=e.item,s=e.type,o=e.tname,i=e.assoc,c=null,a=0;if(r!==null){if(I(n,r.client)<=r.clock)return null;let l=br(n,r),d=l.item;if(!(d instanceof A))return null;if(c=d.parent,c._item===null||!c._item.deleted){a=d.deleted||!d.countable?0:l.diff+(i>=0?0:1);let u=d.left;for(;u!==null;)!u.deleted&&u.countable&&(a+=u.length),u=u.left}}else{if(o!==null)c=t.get(o);else if(s!==null){if(I(n,s.client)<=s.clock)return null;let{item:l}=br(n,s);if(l instanceof A&&l.content instanceof Y)c=l.content.type;else return null}else throw K();i>=0?a=c._length:a=0}return Ec(c,a,e.assoc)},Lc=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&Gt(e.item,t.item)&&Gt(e.type,t.type)&&e.assoc===t.assoc,Re=class{constructor(t,n){this.ds=t,this.sv=n}},Bc=(e,t)=>{let n=e.ds.clients,r=t.ds.clients,s=e.sv,o=t.sv;if(s.size!==o.size||n.size!==r.size)return!1;for(let[i,c]of s.entries())if(o.get(i)!==c)return!1;for(let[i,c]of n.entries()){let a=r.get(i)||[];if(c.length!==a.length)return!1;for(let l=0;l<c.length;l++){let d=c[l],u=a[l];if(d.clock!==u.clock||d.len!==u.len)return!1}}return!0},to=(e,t=new fe)=>(ut(t,e.ds),Er(t,e.sv),t.toUint8Array()),Oc=e=>to(e,new It),eo=(e,t=new bn(R(e)))=>new Re(Tt(t),Xs(t)),Nc=e=>eo(e,new Wt(R(e))),Ar=(e,t)=>new Re(e,t),Mc=Ar(Tn(),new Map),Vc=e=>Ar(kr(e.store),He(e.store)),Jt=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!me(t.ds,e.id),mn=(e,t)=>{let n=ct(e.meta,mn,Rt),r=e.doc.store;n.has(t)||(t.sv.forEach((s,o)=>{s<I(r,o)&&$(e,k(o,s))}),Dt(e,t.ds,s=>{}),n.add(t))},Rc=(e,t,n=new wt)=>{if(e.gc)throw new Error("originDoc must not be garbage collected");let{sv:r,ds:s}=t,o=new ot;return e.transact(i=>{let c=0;r.forEach(a=>{a>0&&c++}),S(o.restEncoder,c);for(let[a,l]of r){if(l===0)continue;l<I(e.store,a)&&$(i,k(a,l));let d=e.store.clients.get(a)||[],u=et(d,l-1);S(o.restEncoder,u+1),o.writeClient(a),S(o.restEncoder,0);for(let h=0;h<=u;h++)d[h].write(o,0)}ut(o,s)}),In(n,o.toUint8Array(),"snapshot"),n},Sn=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},He=e=>{let t=new Map;return e.clients.forEach((n,r)=>{let s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},I=(e,t)=>{let n=e.clients.get(t);if(n===void 0)return 0;let r=n[n.length-1];return r.id.clock+r.length},no=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{let r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw K()}n.push(t)},et=(e,t)=>{let n=0,r=e.length-1,s=e[r],o=s.id.clock;if(o===t)return r;let i=re(t/(o+s.length-1)*r);for(;n<=r;){if(s=e[i],o=s.id.clock,o<=t){if(t<o+s.length)return i;n=i+1}else r=i-1;i=re((n+r)/2)}throw K()},Fc=(e,t)=>{let n=e.clients.get(t.client);return n[et(n,t.clock)]},Le=Fc,gr=(e,t,n)=>{let r=et(t,n),s=t[r];return s.id.clock<n&&s instanceof A?(t.splice(r+1,0,Dn(e,s,n-s.id.clock)),r+1):r},$=(e,t)=>{let n=e.doc.store.clients.get(t.client);return n[gr(e,n,t.clock)]},Ps=(e,t,n)=>{let r=t.clients.get(n.client),s=et(r,n.clock),o=r[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==P&&r.splice(s+1,0,Dn(e,o,n.clock-o.id.clock+1)),o},$c=(e,t,n)=>{let r=e.clients.get(t.id.client);r[et(r,t.id.clock)]=n},ro=(e,t,n,r,s)=>{if(r===0)return;let o=n+r,i=gr(e,t,n),c;do c=t[i++],o<c.id.clock+c.length&&gr(e,t,o),s(c);while(i<t.length&&t[i].id.clock<o)},kn=class{constructor(t,n,r){this.doc=t,this.deleteSet=new At,this.beforeState=He(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}},zs=(e,t)=>t.deleteSet.clients.size===0&&!is(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(Sr(t.deleteSet),gc(e,t),ut(e,t.deleteSet),!0),qs=(e,t,n)=>{let r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&ct(e.changed,t,Rt).add(n)},yn=(e,t)=>{let n=e[t-1],r=e[t];n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)&&(e.splice(t,1),r instanceof A&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n))},so=(e,t,n)=>{for(let[r,s]of e.clients.entries()){let o=t.clients.get(r);for(let i=s.length-1;i>=0;i--){let c=s[i],a=c.clock+c.len;for(let l=et(o,c.clock),d=o[l];l<o.length&&d.id.clock<a;d=o[++l]){let u=o[l];if(c.clock+c.len<=u.id.clock)break;u instanceof A&&u.deleted&&!u.keep&&n(u)&&u.gc(t,!1)}}}},oo=(e,t)=>{e.clients.forEach((n,r)=>{let s=t.clients.get(r);for(let o=n.length-1;o>=0;o--){let i=n[o],c=Qe(s.length-1,1+et(s,i.clock+i.len-1));for(let a=c,l=s[a];a>0&&l.id.clock>=i.clock;l=s[--a])yn(s,a)}})},Pc=(e,t,n)=>{so(e,t,n),oo(e,t)},io=(e,t)=>{if(t<e.length){let n=e[t],r=n.doc,s=r.store,o=n.deleteSet,i=n._mergeStructs;try{Sr(o),n.afterState=He(n.doc.store),r._transaction=null,r.emit("beforeObserverCalls",[n,r]);let c=[];n.changed.forEach((a,l)=>c.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,a)})),c.push(()=>{n.changedParentTypes.forEach((a,l)=>c.push(()=>{(l._item===null||!l._item.deleted)&&(a=a.filter(d=>d.target._item===null||!d.target._item.deleted),a.forEach(d=>{d.currentTarget=l}),a.sort((d,u)=>d.path.length-u.path.length),Qs(l._dEH,a,n))})),c.push(()=>r.emit("afterTransaction",[n,r]))}),je(c,[])}finally{r.gc&&so(o,s,r.gcFilter),oo(o,s),n.afterState.forEach((d,u)=>{let h=n.beforeState.get(u)||0;if(h!==d){let f=s.clients.get(u),y=mt(et(f,h),1);for(let x=f.length-1;x>=y;x--)yn(f,x)}});for(let d=0;d<i.length;d++){let{client:u,clock:h}=i[d].id,f=s.clients.get(u),y=et(f,h);y+1<f.length&&yn(f,y+1),y>0&&yn(f,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(un(dn,cn,"[yjs] ",an,ln,"Changed the client-id because another client seems to be using it."),r.clientID=Zs()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){let d=new bt;zs(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){let d=new ot;zs(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}let{subdocsAdded:c,subdocsLoaded:a,subdocsRemoved:l}=n;(c.size>0||l.size>0||a.size>0)&&(c.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),l.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:a,added:c,removed:l},r,n]),l.forEach(d=>d.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):io(e,t+1)}}},T=(e,t,n=null,r=!0)=>{let s=e._transactionCleanups,o=!1;e._transaction===null&&(o=!0,e._transaction=new kn(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{o&&s[0]===e._transaction&&io(s,0)}},mr=class{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}},Hs=(e,t,n)=>{Dt(e,n.deletions,r=>{r instanceof A&&t.scope.some(s=>Ve(s,r))&&Br(r,!1)})},Js=(e,t,n)=>{let r=null,s=null,o=e.doc,i=e.scope;if(T(o,c=>{for(;t.length>0&&r===null;){let a=o.store,l=t.pop(),d=new Set,u=[],h=!1;Dt(c,l.insertions,f=>{if(f instanceof A){if(f.redone!==null){let{item:y,diff:x}=br(a,f.id);x>0&&(y=$(c,k(y.id.client,y.id.clock+x))),f=y}!f.deleted&&i.some(y=>Ve(y,f))&&u.push(f)}}),Dt(c,l.deletions,f=>{f instanceof A&&i.some(y=>Ve(y,f))&&!me(l.insertions,f.id)&&d.add(f)}),d.forEach(f=>{h=Lo(c,f,d,l.insertions,e.ignoreRemoteMapChanges)!==null||h});for(let f=u.length-1;f>=0;f--){let y=u[f];e.deleteFilter(y)&&(y.delete(c),h=!0)}r=h?l:null}c.changed.forEach((a,l)=>{a.has(null)&&l._searchMarker&&(l._searchMarker.length=0)}),s=c},e),r!=null){let c=s.changedParentTypes;e.emit("stack-item-popped",[{stackItem:r,type:n,changedParentTypes:c},e])}return r},yr=class extends ne{constructor(t,{captureTimeout:n=500,captureTransaction:r=a=>!0,deleteFilter:s=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:i=!1,doc:c=Qn(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=s,o.add(this),this.trackedOrigins=o,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=c,this.lastChange=0,this.ignoreRemoteMapChanges=i,this.afterTransactionHandler=a=>{if(!this.captureTransaction(a)||!this.scope.some(U=>a.changedParentTypes.has(U))||!this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;let l=this.undoing,d=this.redoing,u=l?this.redoStack:this.undoStack;l?this.stopCapturing():d||this.clear(!1,!0);let h=new At;a.afterState.forEach((U,C)=>{let D=a.beforeState.get(C)||0,O=U-D;O>0&&Me(h,C,D,O)});let f=on(),y=!1;if(f-this.lastChange<n&&u.length>0&&!l&&!d){let U=u[u.length-1];U.deletions=Ne([U.deletions,a.deleteSet]),U.insertions=Ne([U.insertions,h])}else u.push(new mr(a.deleteSet,h)),y=!0;!l&&!d&&(this.lastChange=f),Dt(a,a.deleteSet,U=>{U instanceof A&&this.scope.some(C=>Ve(C,U))&&Br(U,!0)});let x=[{stackItem:u[u.length-1],origin:a.origin,type:l?"redo":"undo",changedParentTypes:a.changedParentTypes},this];y?this.emit("stack-item-added",x):this.emit("stack-item-updated",x)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=Qn(t)?t:[t],t.forEach(n=>{this.scope.every(r=>r!==n)&&this.scope.push(n)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>Hs(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>Hs(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=Js(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=Js(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}};function*zc(e){let t=v(e.restDecoder);for(let n=0;n<t;n++){let r=v(e.restDecoder),s=e.readClient(),o=v(e.restDecoder);for(let i=0;i<r;i++){let c=e.readInfo();if(c===10){let a=v(e.restDecoder);yield new z(k(s,o),a),o+=a}else if(31&c){let a=(c&192)===0,l=new A(k(s,o),null,(c&128)===128?e.readLeftID():null,null,(c&64)===64?e.readRightID():null,a?e.readParentInfo()?e.readString():e.readLeftID():null,a&&(c&32)===32?e.readString():null,Bo(e,c));yield l,o+=l.length}else{let a=e.readLen();yield new P(k(s,o),a),o+=a}}}}var xt=class{constructor(t,n){this.gen=zc(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===z);return this.curr}},qc=e=>co(e,st),co=(e,t=tt)=>{let n=[],r=new t(R(e)),s=new xt(r,!1);for(let i=s.curr;i!==null;i=s.next())n.push(i);un("Structs: ",n);let o=Tt(r);un("DeleteSet: ",o)},Hc=e=>ao(e,st),ao=(e,t=tt)=>{let n=[],r=new t(R(e)),s=new xt(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);return{structs:n,ds:Tt(r)}},Fe=class{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}},lo=e=>$e(e,st,bt),uo=(e,t=fe,n=tt)=>{let r=new t,s=new xt(new n(R(e)),!1),o=s.curr;if(o!==null){let i=0,c=o.id.client,a=o.id.clock!==0,l=a?0:o.id.clock+o.length;for(;o!==null;o=s.next())c!==o.id.client&&(l!==0&&(i++,S(r.restEncoder,c),S(r.restEncoder,l)),c=o.id.client,l=0,a=o.id.clock!==0),o.constructor===z&&(a=!0),a||(l=o.id.clock+o.length);l!==0&&(i++,S(r.restEncoder,c),S(r.restEncoder,l));let d=qt();return S(d,i),bs(d,r.restEncoder),r.restEncoder=d,r.toUint8Array()}else return S(r.restEncoder,0),r.toUint8Array()},Jc=e=>uo(e,It,st),ho=(e,t=tt)=>{let n=new Map,r=new Map,s=new xt(new t(R(e)),!1),o=s.curr;if(o!==null){let i=o.id.client,c=o.id.clock;for(n.set(i,c);o!==null;o=s.next())i!==o.id.client&&(r.set(i,c),n.set(o.id.client,o.id.clock),i=o.id.client),c=o.id.clock+o.length;r.set(i,c)}return{from:n,to:r}},Gc=e=>ho(e,st),Wc=(e,t)=>{if(e.constructor===P){let{client:n,clock:r}=e.id;return new P(k(n,r+t),e.length-t)}else if(e.constructor===z){let{client:n,clock:r}=e.id;return new z(k(n,r+t),e.length-t)}else{let n=e,{client:r,clock:s}=n.id;return new A(k(r,s+t),null,k(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},$e=(e,t=tt,n=ot)=>{if(e.length===1)return e[0];let r=e.map(d=>new t(R(d))),s=r.map(d=>new xt(d,!0)),o=null,i=new n,c=new Fe(i);for(;s=s.filter(h=>h.curr!==null),s.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){let y=h.curr.id.clock-f.curr.id.clock;return y===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===z?1:-1:y}else return f.curr.id.client-h.curr.id.client}),s.length!==0;){let d=s[0],u=d.curr.id.client;if(o!==null){let h=d.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=o.struct.id.clock+o.struct.length&&h.id.client>=o.struct.id.client;)h=d.next(),f=!0;if(h===null||h.id.client!==u||f&&h.id.clock>o.struct.id.clock+o.struct.length)continue;if(u!==o.struct.id.client)Et(c,o.struct,o.offset),o={struct:h,offset:0},d.next();else if(o.struct.id.clock+o.struct.length<h.id.clock)if(o.struct.constructor===z)o.struct.length=h.id.clock+h.length-o.struct.id.clock;else{Et(c,o.struct,o.offset);let y=h.id.clock-o.struct.id.clock-o.struct.length;o={struct:new z(k(u,o.struct.id.clock+o.struct.length),y),offset:0}}else{let y=o.struct.id.clock+o.struct.length-h.id.clock;y>0&&(o.struct.constructor===z?o.struct.length-=y:h=Wc(h,y)),o.struct.mergeWith(h)||(Et(c,o.struct,o.offset),o={struct:h,offset:0},d.next())}}else o={struct:d.curr,offset:0},d.next();for(let h=d.curr;h!==null&&h.id.client===u&&h.id.clock===o.struct.id.clock+o.struct.length&&h.constructor!==z;h=d.next())Et(c,o.struct,o.offset),o={struct:h,offset:0}}o!==null&&(Et(c,o.struct,o.offset),o=null),Tr(c);let a=r.map(d=>Tt(d)),l=Ne(a);return ut(i,l),i.toUint8Array()},Dr=(e,t,n=tt,r=ot)=>{let s=Cr(t),o=new r,i=new Fe(o),c=new n(R(e)),a=new xt(c,!1);for(;a.curr;){let d=a.curr,u=d.id.client,h=s.get(u)||0;if(a.curr.constructor===z){a.next();continue}if(d.id.clock+d.length>h)for(Et(i,d,mt(h-d.id.clock,0)),a.next();a.curr&&a.curr.id.client===u;)Et(i,a.curr,0),a.next();else for(;a.curr&&a.curr.id.client===u&&a.curr.id.clock+a.curr.length<=h;)a.next()}Tr(i);let l=Tt(c);return ut(o,l),o.toUint8Array()},Kc=(e,t)=>Dr(e,t,st,bt),fo=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:G(e.encoder.restEncoder)}),e.encoder.restEncoder=qt(),e.written=0)},Et=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&fo(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),S(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Tr=e=>{fo(e);let t=e.encoder.restEncoder;S(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){let r=e.clientStructs[n];S(t,r.written),he(t,r.restEncoder)}},po=(e,t,n)=>{let r=new t(R(e)),s=new xt(r,!1),o=new n,i=new Fe(o);for(let a=s.curr;a!==null;a=s.next())Et(i,a,0);Tr(i);let c=Tt(r);return ut(o,c),o.toUint8Array()},Zc=e=>po(e,st,ot),go=e=>po(e,tt,bt),Kt=class{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null}get path(){return Yc(this.currentTarget,this.target)}deletes(t){return me(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){let t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){let o=n._map.get(s),i,c;if(this.adds(o)){let a=o.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(o))if(a!==null&&this.deletes(a))i="delete",c=Ye(a.content.getContent());else return;else a!==null&&this.deletes(a)?(i="update",c=Ye(a.content.getContent())):(i="add",c=void 0)}else if(this.deletes(o))i="delete",c=Ye(o.content.getContent());else return;t.set(s,{action:i,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){let n=this.target,r=Rt(),s=Rt(),o=[];if(t={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null,a=()=>{c&&o.push(c)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((c===null||c.delete===void 0)&&(a(),c={delete:0}),c.delete+=l.length,s.add(l)):this.adds(l)?((c===null||c.insert===void 0)&&(a(),c={insert:[]}),c.insert=c.insert.concat(l.content.getContent()),r.add(l)):((c===null||c.retain===void 0)&&(a(),c={retain:0}),c.retain+=l.length);c!==null&&c.retain===void 0&&a()}this._changes=t}return t}},Yc=(e,t)=>{let n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}t=t._item.parent}return n},mo=80,Ir=0,wr=class{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Ir++}},Xc=e=>{e.timestamp=Ir++},yo=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Ir++},Qc=(e,t,n)=>{if(e.length>=mo){let r=e.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return yo(r,t,n),r}else{let r=new wr(t,n);return e.push(r),r}},jn=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;let n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,i)=>se(t-o.index)<se(t-i.index)?o:i),r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,Xc(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&se(n.index-s)<r.parent.length/mo?(yo(n,r,s),n):Qc(e._searchMarker,r,s)},Pe=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){let s=e[r];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}s.p=o,o.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=mt(t,s.index+n))}},ta=e=>{let t=e._start,n=[];for(;t;)n.push(t),t=t.right;return n},Ln=(e,t,n)=>{let r=e,s=t.changedParentTypes;for(;ct(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Qs(r._eH,n,t)},L=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ms(),this._dEH=Ms(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw rt()}clone(){throw rt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Vs(this._eH,t)}observeDeep(t){Vs(this._dEH,t)}unobserve(t){Rs(this._eH,t)}unobserveDeep(t){Rs(this._dEH,t)}toJSON(){}},wo=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t,s=[],o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){let i=o.content.getContent();if(i.length<=t)t-=i.length;else{for(let c=t;c<i.length&&r>0;c++)s.push(i[c]),r--;t=0}}o=o.right}return s},bo=e=>{let t=[],n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){let r=n.content.getContent();for(let s=0;s<r.length;s++)t.push(r[s])}n=n.right}return t},ea=(e,t)=>{let n=[],r=e._start;for(;r!==null;){if(r.countable&&Jt(r,t)){let s=r.content.getContent();for(let o=0;o<s.length;o++)n.push(s[o])}r=r.right}return n},ze=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let o=0;o<s.length;o++)t(s[o],n++,e)}r=r.right}},xo=(e,t)=>{let n=[];return ze(e,(r,s)=>{n.push(t(r,s,e))}),n},na=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}let s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},So=(e,t)=>{let n=jn(e,t),r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Un=(e,t,n,r)=>{let s=n,o=e.doc,i=o.clientID,c=o.store,a=n===null?t._start:n.right,l=[],d=()=>{l.length>0&&(s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new pt(l)),s.integrate(e,0),l=[])};r.forEach(u=>{if(u===null)l.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(u);break;default:switch(d(),u.constructor){case Uint8Array:case ArrayBuffer:s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new Lt(new Uint8Array(u))),s.integrate(e,0);break;case wt:s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new Xt(u)),s.integrate(e,0);break;default:if(u instanceof L)s=new A(k(i,I(c,i)),s,s&&s.lastId,a,a&&a.id,t,null,new Y(u)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},ko=Ie("Length exceeded!"),Uo=(e,t,n,r)=>{if(n>t._length)throw ko;if(n===0)return t._searchMarker&&Pe(t._searchMarker,n,r.length),Un(e,t,null,r);let s=n,o=jn(t,n),i=t._start;for(o!==null&&(i=o.p,n-=o.index,n===0&&(i=i.prev,n+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(n<=i.length){n<i.length&&$(e,k(i.id.client,i.id.clock+n));break}n-=i.length}return t._searchMarker&&Pe(t._searchMarker,s,r.length),Un(e,t,i,r)},ra=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((o,i)=>i.index>o.index?i:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return Un(e,t,s,n)},vo=(e,t,n,r)=>{if(r===0)return;let s=n,o=r,i=jn(t,n),c=t._start;for(i!==null&&(c=i.p,n-=i.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&$(e,k(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&$(e,k(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw ko;t._searchMarker&&Pe(t._searchMarker,s,-o+r)},vn=(e,t,n)=>{let r=t._map.get(n);r!==void 0&&r.delete(e)},jr=(e,t,n,r)=>{let s=t._map.get(n)||null,o=e.doc,i=o.clientID,c;if(r==null)c=new pt([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:c=new pt([r]);break;case Uint8Array:c=new Lt(r);break;case wt:c=new Xt(r);break;default:if(r instanceof L)c=new Y(r);else throw new Error("Unexpected content type")}new A(k(i,I(o.store,i)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},Lr=(e,t)=>{let n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Co=e=>{let t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},Eo=(e,t)=>{let n=e._map.get(t);return n!==void 0&&!n.deleted},sa=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&Jt(r,n)?r.content.getContent()[r.length-1]:void 0},pn=e=>Ls(e.entries(),t=>!t[1].deleted),Cn=class extends Kt{constructor(t,n){super(t,n),this._transaction=n}},M=class extends L{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){let n=new M;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new M}clone(){let t=new M;return t.insert(0,this.toArray().map(n=>n instanceof L?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),Ln(this,t,new Cn(this,t))}insert(t,n){this.doc!==null?T(this.doc,r=>{Uo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?T(this.doc,n=>{ra(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?T(this.doc,r=>{vo(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return So(this,t)}toArray(){return bo(this)}slice(t=0,n=this.length){return wo(this,t,n)}toJSON(){return this.map(t=>t instanceof L?t.toJSON():t)}map(t){return xo(this,t)}forEach(t){ze(this,t)}[Symbol.iterator](){return na(this)}_write(t){t.writeTypeRef(Ua)}},oa=e=>new M,En=class extends Kt{constructor(t,n,r){super(t,n),this.keysChanged=r}},q=class extends L{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new q}clone(){let t=new q;return this.forEach((n,r)=>{t.set(r,n instanceof L?n.clone():n)}),t}_callObserver(t,n){Ln(this,t,new En(this,t,n))}toJSON(){let t={};return this._map.forEach((n,r)=>{if(!n.deleted){let s=n.content.getContent()[n.length-1];t[r]=s instanceof L?s.toJSON():s}}),t}get size(){return[...pn(this._map)].length}keys(){return hn(pn(this._map),t=>t[0])}values(){return hn(pn(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return hn(pn(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){let n={};return this._map.forEach((r,s)=>{r.deleted||t(r.content.getContent()[r.length-1],s,this)}),n}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?T(this.doc,n=>{vn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?T(this.doc,r=>{jr(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Lr(this,t)}has(t){return Eo(this,t)}clear(){this.doc!==null?T(this.doc,t=>{this.forEach(function(n,r,s){vn(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(va)}},ia=e=>new q,_t=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Cs(e,t),qe=class{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&K(),this.right.content.constructor){case B:this.right.deleted||ye(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Gs=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case B:t.right.deleted||ye(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&$(e,k(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},gn=(e,t,n)=>{let r=new Map,s=jn(t,n);if(s){let o=new qe(s.p.left,s.p,s.index,r);return Gs(e,o,n-s.index)}else{let o=new qe(null,t._start,0,r);return Gs(e,o,n)}},_o=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===B&&_t(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();let s=e.doc,o=s.clientID;r.forEach((i,c)=>{let a=n.left,l=n.right,d=new A(k(o,I(s.store,o)),a,a&&a.lastId,l,l&&l.id,t,null,new B(c,i));d.integrate(e,0),n.right=d,n.forward()})},ye=(e,t)=>{let{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Ao=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===B&&_t(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},Do=(e,t,n,r)=>{let s=e.doc,o=s.clientID,i=new Map;for(let c in r){let a=r[c],l=n.currentAttributes.get(c)||null;if(!_t(l,a)){i.set(c,l);let{left:d,right:u}=n;n.right=new A(k(o,I(s.store,o)),d,d&&d.lastId,u,u&&u.id,t,null,new B(c,a)),n.right.integrate(e,0),n.forward()}}return i},ur=(e,t,n,r,s)=>{n.currentAttributes.forEach((h,f)=>{s[f]===void 0&&(s[f]=null)});let o=e.doc,i=o.clientID;Ao(n,s);let c=Do(e,t,n,s),a=r.constructor===String?new Z(r):r instanceof L?new Y(r):new ft(r),{left:l,right:d,index:u}=n;t._searchMarker&&Pe(t._searchMarker,n.index,a.getLength()),d=new A(k(i,I(o.store,i)),l,l&&l.lastId,d,d&&d.id,t,null,a),d.integrate(e,0),n.right=d,n.index=u,n.forward(),_o(e,t,n,c)},Ws=(e,t,n,r,s)=>{let o=e.doc,i=o.clientID;Ao(n,s);let c=Do(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===B));){if(!n.right.deleted)switch(n.right.content.constructor){case B:{let{key:a,value:l}=n.right.content,d=s[a];if(d!==void 0){if(_t(d,l))c.delete(a);else{if(r===0)break t;c.set(a,l)}n.right.delete(e)}else n.currentAttributes.set(a,l);break}default:r<n.right.length&&$(e,k(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let a="";for(;r>0;r--)a+=`
`;n.right=new A(k(i,I(o.store,i)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Z(a)),n.right.integrate(e,0),n.forward()}_o(e,t,n,c)},To=(e,t,n,r,s)=>{let o=n,i=ve(s);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===B&&ye(i,o.content),o=o.right;let c=0,a=!1;for(;t!==o;){if(n===t&&(a=!0),!t.deleted){let l=t.content;switch(l.constructor){case B:{let{key:d,value:u}=l;((i.get(d)||null)!==u||(r.get(d)||null)===u)&&(t.delete(e),c++,!a&&(s.get(d)||null)===u&&(r.get(d)||null)!==u&&s.delete(d));break}}}t=t.right}return c},ca=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===B){let r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Io=e=>{let t=0;return T(e.doc,n=>{let r=e._start,s=e._start,o=H(),i=ve(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case B:ye(i,s.content);break;default:t+=To(n,r,s,o,i),o=ve(i),r=s;break}s=s.right}}),t},Ks=(e,t,n)=>{let r=n,s=ve(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Y:case ft:case Z:n<t.right.length&&$(e,k(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&To(e,o,t.right,s,t.currentAttributes);let i=(t.left||t.right).parent;return i._searchMarker&&Pe(i._searchMarker,t.index,-r+n),t},_n=class extends Kt{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){let t=this.target.doc,n=[];T(t,r=>{let s=new Map,o=new Map,i=this.target._start,c=null,a={},l="",d=0,u=0,h=()=>{if(c!==null){let f;switch(c){case"delete":f={delete:u},u=0;break;case"insert":f={insert:l},s.size>0&&(f.attributes={},s.forEach((y,x)=>{y!==null&&(f.attributes[x]=y)})),l="";break;case"retain":if(f={retain:d},Object.keys(a).length>0){f.attributes={};for(let y in a)f.attributes[y]=a[y]}d=0;break}n.push(f),c=null}};for(;i!==null;){switch(i.content.constructor){case Y:case ft:this.adds(i)?this.deletes(i)||(h(),c="insert",l=i.content.getContent()[0],h()):this.deletes(i)?(c!=="delete"&&(h(),c="delete"),u+=1):i.deleted||(c!=="retain"&&(h(),c="retain"),d+=1);break;case Z:this.adds(i)?this.deletes(i)||(c!=="insert"&&(h(),c="insert"),l+=i.content.str):this.deletes(i)?(c!=="delete"&&(h(),c="delete"),u+=i.length):i.deleted||(c!=="retain"&&(h(),c="retain"),d+=i.length);break;case B:{let{key:f,value:y}=i.content;if(this.adds(i)){if(!this.deletes(i)){let x=s.get(f)||null;_t(x,y)?y!==null&&i.delete(r):(c==="retain"&&h(),_t(y,o.get(f)||null)?delete a[f]:a[f]=y)}}else if(this.deletes(i)){o.set(f,y);let x=s.get(f)||null;_t(x,y)||(c==="retain"&&h(),a[f]=x)}else if(!i.deleted){o.set(f,y);let x=a[f];x!==void 0&&(_t(x,y)?x!==null&&i.delete(r):(c==="retain"&&h(),y===null?delete a[f]:a[f]=y))}i.deleted||(c==="insert"&&h(),ye(s,i.content));break}}i=i.right}for(h();n.length>0;){let f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}},St=class extends L{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new St}clone(){let t=new St;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);let r=new _n(this,t,n),s=t.doc;if(Ln(this,t,r),!t.local){let o=!1;for(let[i,c]of t.afterState.entries()){let a=t.beforeState.get(i)||0;if(c!==a&&(ro(t,s.store.clients.get(i),a,c,l=>{!l.deleted&&l.content.constructor===B&&(o=!0)}),o))break}o||Dt(t,t.deleteSet,i=>{i instanceof P||o||i.parent===this&&i.content.constructor===B&&(o=!0)}),T(s,i=>{o?Io(this):Dt(i,i.deleteSet,c=>{c instanceof P||c.parent===this&&ca(i,c)})})}}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Z&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?T(this.doc,r=>{let s=new qe(null,this._start,0,new Map);for(let o=0;o<t.length;o++){let i=t[o];if(i.insert!==void 0){let c=!n&&typeof i.insert=="string"&&o===t.length-1&&s.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof c!="string"||c.length>0)&&ur(r,this,s,c,i.attributes||{})}else i.retain!==void 0?Ws(r,this,s,i.retain,i.attributes||{}):i.delete!==void 0&&Ks(r,s,i.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){let s=[],o=new Map,i=this.doc,c="",a=this._start;function l(){if(c.length>0){let d={},u=!1;o.forEach((f,y)=>{u=!0,d[y]=f});let h={insert:c};u&&(h.attributes=d),s.push(h),c=""}}return T(i,d=>{for(t&&mn(d,t),n&&mn(d,n);a!==null;){if(Jt(a,t)||n!==void 0&&Jt(a,n))switch(a.content.constructor){case Z:{let u=o.get("ychange");t!==void 0&&!Jt(a,t)?(u===void 0||u.user!==a.id.client||u.state!=="removed")&&(l(),o.set("ychange",r?r("removed",a.id):{type:"removed"})):n!==void 0&&!Jt(a,n)?(u===void 0||u.user!==a.id.client||u.state!=="added")&&(l(),o.set("ychange",r?r("added",a.id):{type:"added"})):u!==void 0&&(l(),o.delete("ychange")),c+=a.content.str;break}case Y:case ft:{l();let u={insert:a.content.getContent()[0]};if(o.size>0){let h={};u.attributes=h,o.forEach((f,y)=>{h[y]=f})}s.push(u);break}case B:Jt(a,t)&&(l(),ye(o,a.content));break}a=a.right}l()},mn),s}insert(t,n,r){if(n.length<=0)return;let s=this.doc;s!==null?T(s,o=>{let i=gn(o,this,t);r||(r={},i.currentAttributes.forEach((c,a)=>{r[a]=c})),ur(o,this,i,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r={}){let s=this.doc;s!==null?T(s,o=>{let i=gn(o,this,t);ur(o,this,i,n,r)}):this._pending.push(()=>this.insertEmbed(t,n,r))}delete(t,n){if(n===0)return;let r=this.doc;r!==null?T(r,s=>{Ks(s,gn(s,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;let s=this.doc;s!==null?T(s,o=>{let i=gn(o,this,t);i.right!==null&&Ws(o,this,i,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?T(this.doc,n=>{vn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?T(this.doc,r=>{jr(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Lr(this,t)}getAttributes(t){return Co(this)}_write(t){t.writeTypeRef(Ca)}},aa=e=>new St,Be=class{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===jt||n.constructor===ht)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}},ht=class extends L{constructor(){super(),this._prelimContent=[]}get firstChild(){let t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ht}clone(){let t=new ht;return t.insert(0,this.toArray().map(n=>n instanceof L?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Be(this,t)}querySelector(t){t=t.toUpperCase();let r=new Be(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new Be(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Ln(this,t,new An(this,n,t))}toString(){return xo(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){let s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ze(this,o=>{s.insertBefore(o.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?T(this.doc,r=>{Uo(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)T(this.doc,r=>{let s=t&&t instanceof L?t._item:t;Un(r,this,s,n)});else{let r=this._prelimContent,s=t===null?0:r.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw Ie("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?T(this.doc,r=>{vo(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return bo(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return So(this,t)}slice(t=0,n=this.length){return wo(this,t,n)}forEach(t){ze(this,t)}_write(t){t.writeTypeRef(_a)}},la=e=>new ht,jt=class extends ht{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new jt(this.nodeName)}clone(){let t=new jt(this.nodeName),n=this.getAttributes();for(let r in n)t.setAttribute(r,n[r]);return t.insert(0,this.toArray().map(r=>r instanceof L?r.clone():r)),t}toString(){let t=this.getAttributes(),n=[],r=[];for(let c in t)r.push(c);r.sort();let s=r.length;for(let c=0;c<s;c++){let a=r[c];n.push(a+'="'+t[a]+'"')}let o=this.nodeName.toLocaleLowerCase(),i=n.length>0?" "+n.join(" "):"";return`<${o}${i}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?T(this.doc,n=>{vn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?T(this.doc,r=>{jr(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Lr(this,t)}hasAttribute(t){return Eo(this,t)}getAttributes(t){return Co(this)}toDOM(t=document,n={},r){let s=t.createElement(this.nodeName),o=this.getAttributes();for(let i in o)s.setAttribute(i,o[i]);return ze(this,i=>{s.appendChild(i.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(Ea),t.writeKey(this.nodeName)}},da=e=>new jt(e.readKey()),An=class extends Kt{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Zt=class extends q{constructor(t){super(),this.hookName=t}_copy(){return new Zt(this.hookName)}clone(){let t=new Zt(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){let s=n[this.hookName],o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(Aa),t.writeKey(this.hookName)}},ua=e=>new Zt(e.readKey()),Yt=class extends St{get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new Yt}clone(){let t=new Yt;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){let s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{let n=[];for(let s in t.attributes){let o=[];for(let i in t.attributes[s])o.push({key:i,value:t.attributes[s][i]});o.sort((i,c)=>i.key<c.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){let o=n[s];r+=`<${o.nodeName}`;for(let i=0;i<o.attrs.length;i++){let c=o.attrs[i];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Da)}},ha=e=>new Yt,ge=class{constructor(t,n){this.id=t,this.length=n}get deleted(){throw rt()}mergeWith(t){return!1}write(t,n,r){throw rt()}integrate(t,n){throw rt()}},fa=0,P=class extends ge{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),no(t.doc.store,this)}write(t,n){t.writeInfo(fa),t.writeLen(this.length-n)}getMissing(t,n){return null}},Lt=class{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Lt(this.content)}splice(t){throw rt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}},pa=e=>new Lt(e.readBuf()),Bt=class{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Bt(this.len)}splice(t){let n=new Bt(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Me(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}},ga=e=>new Bt(e.readLen()),jo=(e,t)=>new wt({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1}),Xt=class{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;let n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Xt(jo(this.doc.guid,this.opts))}splice(t){throw rt()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}},ma=e=>new Xt(jo(e.readString(),e.readAny())),ft=class{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ft(this.embed)}splice(t){throw rt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}},ya=e=>new ft(e.readJSON()),B=class{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new B(this.key,this.value)}splice(t){throw rt()}mergeWith(t){return!1}integrate(t,n){n.parent._searchMarker=null}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}},wa=e=>new B(e.readKey(),e.readJSON()),Qt=class{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Qt(this.arr)}splice(t){let n=new Qt(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}},ba=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++){let s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Qt(n)},pt=class{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new pt(this.arr)}splice(t){let n=new pt(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeAny(o)}}getRef(){return 8}},xa=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new pt(n)},Z=class{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Z(this.str)}splice(t){let n=new Z(this.str.slice(t));this.str=this.str.slice(0,t);let r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}},Sa=e=>new Z(e.readString()),ka=[oa,ia,aa,da,la,ua,ha],Ua=0,va=1,Ca=2,Ea=3,_a=4,Aa=5,Da=6,Y=class{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Y(this.type._copy())}splice(t){throw rt()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}},Ta=e=>new Y(ka[e.readTypeRef()](e)),br=(e,t)=>{let n=t,r=0,s;do r>0&&(n=k(n.client,n.clock+r)),s=Le(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof A);return{item:s,diff:r}},Br=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},Dn=(e,t,n)=>{let{client:r,clock:s}=t.id,o=new A(k(r,s+n),t,k(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=k(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o},Lo=(e,t,n,r,s)=>{let o=e.doc,i=o.store,c=o.clientID,a=t.redone;if(a!==null)return $(e,a);let l=t.parent._item,d=null,u;if(l!==null&&l.deleted===!0){if(l.redone===null&&(!n.has(l)||Lo(e,l,n,r,s)===null))return null;for(;l.redone!==null;)l=$(e,l.redone)}let h=l===null?t.parent:l.content.type;if(t.parentSub===null){for(d=t.left,u=t;d!==null;){let U=d;for(;U!==null&&U.parent._item!==l;)U=U.redone===null?null:$(e,U.redone);if(U!==null&&U.parent._item===l){d=U;break}d=d.left}for(;u!==null;){let U=u;for(;U!==null&&U.parent._item!==l;)U=U.redone===null?null:$(e,U.redone);if(U!==null&&U.parent._item===l){u=U;break}u=u.right}}else if(u=null,t.right&&!s){for(d=t;d!==null&&d.right!==null&&me(r,d.right.id);)d=d.right;for(;d!==null&&d.redone!==null;)d=$(e,d.redone);if(d===null||d.parent._item!==l||d&&d.right!==null)return null}else d=h._map.get(t.parentSub)||null;let f=I(i,c),y=k(c,f),x=new A(y,d,d&&d.lastId,u,u&&u.id,h,t.parentSub,t.content.copy());return t.redone=y,Br(x,!0),x.integrate(e,0),x},A=class extends ge{constructor(t,n,r,s,o,i,c,a){super(t,a.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=o,this.parent=i,this.parentSub=c,this.redone=null,this.content=a,this.info=this.content.isCountable()?2:0}set marker(t){(this.info&8)>0!==t&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=I(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=I(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===yt&&this.id.client!==this.parent.client&&this.parent.clock>=I(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ps(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=$(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===P||this.right&&this.right.constructor===P)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===A&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===A&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===yt){let r=Le(n,this.parent);r.constructor===P?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=Ps(t,t.doc.store,k(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let o=new Set,i=new Set;for(;s!==null&&s!==this.right;){if(i.add(s),o.add(s),Gt(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Gt(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&i.has(Le(t.doc.store,s.origin)))o.has(Le(t.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),no(t.doc.store,this),this.content.integrate(t,this),qs(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new P(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:k(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Gt(t.origin,this.lastId)&&this.right===t&&Gt(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){let n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){let n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Me(t.deleteSet,this.id.client,this.id.clock,this.length),qs(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw K();this.content.gc(t),n?$c(t,this,new P(this.id,this.length)):this.content=new Bt(this.length)}write(t,n){let r=n>0?k(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(o===null?0:32);if(t.writeInfo(i),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){let c=this.parent;if(c._item!==void 0){let a=c._item;if(a===null){let l=_r(c);t.writeParentInfo(!0),t.writeString(l)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===yt?(t.writeParentInfo(!1),t.writeLeftID(c)):K();o!==null&&t.writeString(o)}this.content.write(t,n)}},Bo=(e,t)=>Ia[t&31](e),Ia=[()=>{K()},ga,ba,pa,Sa,ya,wa,Ta,xa,ma,()=>{K()}],ja=10,z=class extends ge{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){K()}write(t,n){t.writeInfo(ja),S(t.restEncoder,this.length-n)}getMissing(t,n){return null}},Oo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},No="__ $YJS$ __";Oo[No]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Oo[No]=!0;var Bn=Yo(Vo());function kt(e){if(e instanceof L){e=e.toJSON();for(let[t,n]of Nr(e))Ot(e,t,n,kt)}if(Array.isArray(e))return e.map(kt);if(typeof e=="object"&&e!==null){let t={};for(let[n,r]of Object.entries(e))t[n]=kt(r);return t}return e}function La(e){return Array.isArray(e)?new M:typeof e=="object"&&e!==null?new q:e}function Nr(e){return Array.isArray(e)?[...e.entries()]:typeof e=="object"&&e!==null?Object.entries(e):e instanceof M?e.map((t,n)=>[n,t]):e instanceof q?[...e.entries()]:[]}function Ot(e,t,n,r=La){let s=r(n);if(e instanceof q){e.set(String(t),s),Nr(n).forEach(([o,i])=>{Ot(e.get(String(t)),o,i)});return}if(e instanceof M&&typeof t=="number"){e.length>t&&e.delete(t,1);let o=t-e.length;o>0&&e.push(Array(o).fill(null)),e.insert(t,[s]),Nr(n).forEach(([i,c])=>{Ot(e.get(t),i,c)});return}e[t]=s}function Mr(e,t,n){if(n.path&&n.path.length){let r=e.get(t),s,o=n.path.length-1;for(s=0;s<o;s++)switch(r=r.get(n.path[s]),n.kind){case"A":Mr(r.get(n.path[s]),n.index,n.item);break;case"D":r.delete(n.path[s],1);break;case"E":case"N":Ot(r,n.path[s],n.rhs);break}}else switch(n.kind){case"A":Mr(e.get(t),n.index,n.item);break;case"D":e.delete(t,1);break;case"E":case"N":Ot(e,t,n.rhs);break}return e}function Ro(e,t){if(e&&t&&t.kind){let n=e,r=-1,s=t.path?t.path.length-1:0;for(;++r<s;)typeof n.get(t.path?.[r])>"u"&&Ot(n,t.path?.[r],typeof t.path?.[r+1]=="number"?new M:new q),n=n.get(t.path?.[r]);switch(t.kind){case"A":t.path&&typeof n.get(t.path[r])>"u"&&Ot(n,t.path[r],new M),Mr(t.path?n.get(t.path[r]):n,t.index,t.item);break;case"D":n.delete(t.path?.[r],1);break;case"E":case"N":Ot(n,t.path?.[r],t.rhs);break}}}var Ba=["projects","templates","assets","snippets"],Je="livecodes-data",gt="data",On=self,X=ns(),Nn=async e=>{if(!e)return[];if("getValue"in e){let t=Yn(e,X),n=await Hn(On,{method:"getValue",args:{storeKey:t}});return n!=null?[n]:[]}return e.getAllData()},Fo=async(e,t)=>{if(e){if("setValue"in e){let n=Yn(e,X);await Hn(On,{method:"setValue",args:{storeKey:n,value:t[0]}});return}await e.clear(),await e.restore(t)}},we=(e,t=[])=>{let n=Bn.diff(kt(e),t)||[];e.doc?.transact(()=>{for(let r of n)Ro(e,r)})},Oa=async({user:e,repo:t,branch:n,stores:r,storeKey:s,remoteContent:o})=>{let i=`${e.username}_${s}`,c=(await r.sync?.getItem(i))?.lastSyncSha,a=`${s}.b64.zip`,l=`${Je}/${a}`,d=r[s];if(!d||"getValue"in d)return!0;let h=new F.Doc;try{let f,y=o.find(w=>w.name===a)!=null,x=o.find(w=>w.sha===c)!=null,U=!y||x?void 0:await Ue({user:e,repo:t,branch:n,path:l});if(U?.content){let w=U.encoding==="arrayBuffer"?"binary":"base64";f=await $a(U.content,w)}let C=(await r.sync?.getItem(i))?.data,D=await Nn(d);if(C&&(F.applyUpdate(h,C),we(h.getArray(gt),D),f&&F.applyUpdate(h,f)),!C&&!f&&we(h.getArray(gt),D),!C&&f){let w=new F.Doc;F.applyUpdate(w,f);let _=kt(w.getArray(gt));w.destroy();let E=[..._,...D];we(h.getArray(gt),E)}let O=kt(h.getArray(gt));Bn.diff(O,D)!=null&&await Fo(d,O);let te=F.encodeStateAsUpdate(h),g=!y||f&&!qn(f,te)||x&&C&&!qn(C,te);if(g){let w={path:l,content:await Fa([{filename:a.replace(".zip",""),content:te}])};if(!await Xn({file:w,user:e,repo:t,branch:n,message:"sync "+s}))return!1}let p=(g?(await Ue({user:e,repo:t,branch:n,path:Je}))?.entries:o)?.find?.(w=>w.name===a)?.sha,b={lastModified:Date.now(),data:te,lastSyncSha:p||""};await r.sync?.updateItem(i,b)}catch{return!1}finally{h.destroy()}return!0},Na=async({user:e,repo:t,branch:n="main",newRepo:r})=>{let s=[];try{r?await Xn({file:{path:Je+"/.gitkeep",content:""},user:e,repo:t,branch:n,message:"create data dir",description:"LiveCodes Sync",newRepo:r,privateRepo:!0,readmeContent:"# LiveCodes Sync"}):(await Ue({user:e,repo:t,branch:n,path:""}))?.entries?.find?.(a=>a.type==="dir"&&a.name===Je)&&(s=(await Ue({user:e,repo:t,branch:n,path:Je}))?.entries)}catch{return!1}let o=!0,i=Object.keys(X).filter(c=>Ba.includes(c));for(let c of i)await Oa({user:e,repo:t,branch:n,stores:X,storeKey:c,remoteContent:s})||(o=!1);return o},Ma=async({user:e,storeKey:t})=>{let n=`${e.username}_${t}`,r=X[t];if(!r)return;let{data:s,lastSyncSha:o=""}=await X.sync?.getItem(n)||{},i=await Nn(r),c=new F.Doc;try{s&&F.applyUpdate(c,s),we(c.getArray(gt),i);let a=F.encodeStateAsUpdate(c),l={lastModified:Date.now(),data:a,lastSyncSha:o};await X.sync?.updateItem(n,l)}finally{c.destroy()}},Va=async({storeKey:e})=>{let t=X[e];if(!t)return;let n=await Nn(t),r=new F.Doc;we(r.getArray(gt),n);let s=F.encodeStateAsUpdate(r),o=Gr(s);return r.destroy(),o},$o=async({update:e,storeKey:t,mergeCurrent:n=!0})=>{let r=X[t];if(!r)return;let s="getValue"in r,o=await Nn(r),i=new F.Doc;try{if(F.applyUpdate(i,e),n){let l=kt(i.getArray(gt)),d=s?l:[...l,...o];we(i.getArray(gt),d)}let c=kt(i.getArray(gt));Bn.diff(c,o)!=null&&await Fo(r,c)}finally{i.destroy()}},Ra=async({user:e,storeKey:t,mergeCurrent:n=!0})=>{let r=`${e.username}_${t}`;if(!X[t])return;let o=(await X.sync?.getItem(r))?.data;if(o)return $o({update:o,storeKey:t,mergeCurrent:n})},Fa=async e=>{let t=await ke(Gn,"JSZip"),n=new t;return e.forEach(({filename:r,content:s})=>{n.file(r,s)}),n.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:6}})},$a=async(e,t)=>{let s=(await(await ke(Gn,"JSZip")).loadAsync(e,{base64:t==="base64"})).file(/.*\.b64/);if(s.length>0)return s[0].async("uint8array")};On.addEventListener("message",async e=>{X.projects||await rs(X,!1);let t=e.data,n;t.method==="sync"&&(n=await Na(...t.args)),t.method==="exportToLocalSync"&&(n=await Ma(...t.args)),t.method==="exportStoreAsBase64Update"&&(n=await Va(...t.args)),t.method==="restoreFromUpdate"&&(n=await $o(...t.args)),t.method==="restoreFromLocalSync"&&(n=await Ra(...t.args)),On.postMessage({messageId:t.messageId,method:t.method,data:n})});
})();
