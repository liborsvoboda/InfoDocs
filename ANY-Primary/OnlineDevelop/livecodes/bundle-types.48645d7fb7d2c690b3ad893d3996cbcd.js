var ce=["esm.sh","skypack","jspm"],ae=["unpkg","jsdelivr","fastly.jsdelivr"],pe=["fastly.jsdelivr.gh","jsdelivr.gh","statically"],C={getModuleUrl:(t,{isModule:r=!0,defaultCDN:i="esm.sh"}={})=>{t=t.replace(/#nobundle/g,"");let d=le(t,r,i);return d||(r?"https://esm.sh/"+t:"https://cdn.jsdelivr.net/npm/"+t)},getUrl:(t,r)=>t.startsWith("http")||t.startsWith("data:")?t:le(t,!1,r||Ce())||t,cdnLists:{npm:ae,module:ce,gh:pe},checkCDNs:async(t,r)=>{let i=[r,...C.cdnLists.npm].filter(Boolean);for(let d of i)try{if((await fetch(C.getUrl(t,d),{method:"HEAD"})).ok)return d}catch{}return C.cdnLists.npm[0]}},Ce=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||C.cdnLists.npm[0]}catch{return C.cdnLists.npm[0]}},le=(t,r,i)=>{let d=r&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",pe[0]):t.includes(":")||(t=(i||(r?ce[0]:ae[0]))+":"+t);for(let m of Ee){let[a,b]=m;if(a.test(t))return t.replace(a,b)+d}return null},Ee=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://esm.sh/$2"],[/^(node:)(.+)/i,"https://esm.sh/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly.jsdelivr.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:Ne,getModuleUrl:Fe}=C;var Be="0.6.64",Je=Ne(`malinajs@${Be}/malina.js`);var de=Fe("path-browserify@1.0.1");var De=/^\uFEFF?/,me=/^([ \t]*declare module )(['"])(.+?)(\2[ \t]*{?.*)$/,Q=/^([ \t]*(?:export )?(?:import .+? )= require\()(['"])(.+?)(\2\);.*)$/,fe=/^([ \t]*(?:export|import) ?(?:(?:\* (?:as [^ ,]+)?)|.*)?,? ?(?:[^ ,]+ ?,?)(?:\{(?:[^ ,]+ ?,?)*\})? ?from )(['"])([^ ,]+)(\2;.*)$/,Te=/^[ \t]*\/\/\/[ \t]*<reference[ \t]+path=(["'])(.*?)\1?[ \t]*\/>.*$/,Y=/^\w+(?:[\.-]\w+)*$/,qe=/^([\./].*|.:.*)$/,Re=/^[ \t]*(?:static )?private (?:static )?/,Me=/^([ \t]*)(static |)(public |)(static |)(.*)/;async function Ge(t){let r=await import(de);f(typeof t=="object"&&t,"options must be an object");let i=t.main,d=t.name,m=g(t.baseDir,t.main.split("/").slice(0,-1).join("/")),a=g(t.newline,`
`),b=g(t.indent,"    ")||"    ",N=g(t.prefix,""),F=g(t.separator,"/")||"/",W=g(t.externals,!1),B=g(t.exclude,null),xe=g(t.referenceExternals,!1),ee=g(t.emitOnIncludedFileNotFound,!1),te=g(t.emitOnNoIncludedFileNotFound,!1),_=g(t.headerText,""),z=!1,D=g(t.verbose,!1);f(i,'option "main" must be defined'),f(d,'option "name" must be defined'),f(typeof a=="string",'option "newline" must be a string'),f(typeof b=="string",'option "indent" must be a string'),f(typeof N=="string",'option "prefix" must be a string'),f(F.length>0,'option "separator" must have non-zero length'),s("### settings object passed ###"),je(t),s("### settings ###"),s("main:         %s",i),s("name:         %s",d),s("baseDir:      %s",m),s("mainFile:     %s",i),s("externals:    %s",W?"yes":"no"),s("exclude:      %s",B),s("comments:     %s",z?"yes":"no"),s("emitOnIncludedFileNotFound:   %s",ee?"yes":"no"),s("emitOnNoIncludedFileNotFound: %s",te?"yes":"no"),s("headerText    %s",_);let he=_?"/*"+_+`*/
`:"",T;typeof B=="function"?T=B:B instanceof RegExp?T=e=>B.test(e):T=()=>!1;let[ge,be]=i.split(d,2),M=ge+d+be.split("/")[0]+"/";s(`
### find typings ###`);let V=e=>e.startsWith(M);s("source typings (will be included in output if actually used)"),s("excluded typings (will always be excluded from output)");let k=Object.create(null),se=[],A=null,I=[],Ue=e=>I.indexOf(e)!==-1;{s(`
### parse files ###`);let e=[i],o=Object.create(null);for(;e.length>0;){let n=e.shift();if(!n||o[n])continue;o[n]=!0;let c=await ke(n);c&&(A||(A=c),k[c.file]=c,Ie(e,c.refs,c.relativeImports))}}s(`
### map exports ###`);let J=Object.create(null);Object.keys(k).forEach(e=>{let o=k[e];o.exports.forEach(n=>{f(!(n in J),"already got export for: "+n),J[n]=o,s("- %s -> %s",n,o.file)})}),s(`
### determine typings to include ###`);let X=[],L=[],O=[];{let e=[A],o=Object.create(null);for(s("queue"),s(e);e.length>0;){let n=e.shift();!n||o[n.file]||(o[n.file]=!0,s("%s (%s)",n.name,n.file),L.push(n),n.externalImports.forEach(c=>{let p=J[c];if(p){if(!W){s(" - exclude external %s",c),v(O,p?p?.file:c);return}if(T(r.relative(m,p?.file),!0)){s(" - exclude external filter %s",c),v(X,p?.file);return}s(" - include external %s",c),f(p,c),e.push(p)}}),n.relativeImports.forEach(c=>{let p=k[c];if(p){if(T(r.relative(m,p?.file),!1)){s(" - exclude internal filter %s",c),v(X,p?.file);return}s(" - import relative %s",c),f(p,c),e.push(p)}}))}}s(`
### rewrite global external modules ###`),L.forEach(e=>{s(e.name),e.relativeRef.forEach(o=>{o.modified=We(o.original,K),s(" - %s  ==>  %s",o.original,o.modified)}),e.importLineRef.forEach(o=>{Q.test(o.original)?o.modified=Se(o.original,K):o.modified=Pe(o.original,K),s(" - %s  ==>  %s",o.original,o.modified)})}),s(`
### build output ###`);let j=he;O.length>0&&(j+="// Dependencies for this module:"+a,O.forEach(e=>{xe?j+=Le(r.relative(m,e).replace(/\\/g,"/"))+a:j+="//   "+r.relative(m,e).replace(/\\/g,"/")+a})),se.length>0&&(j+=a,j+=se.join(a)+a),j+=a,j+=L.filter(e=>(e.lines=e.lines.filter(o=>o.skip!==!0),e.lines.length>0)).map(e=>V(e.file)?ve(e.file,e.lines.map(o=>ue(e.indent,b)(o))):e.lines.map(o=>ue(e.indent,b)(o)).join(a)+a).join(a)+a;let H=e=>L.filter(o=>o.file===e).length!==0,y={fileMap:k,includeFilesNotFound:[],noIncludeFilesNotFound:[],options:t};s("## files not found ##");for(let e in k){let o=k[e];o.fileExists||(H(o.file)?(y.includeFilesNotFound.push(o.file),oe(" X Included file NOT FOUND %s ",o.file)):(y.noIncludeFilesNotFound.push(o.file),s(" X Not used file not found %s",o.file)))}return s(`
### write output ###`),(y.includeFilesNotFound.length===0||y.includeFilesNotFound.length>0&&ee)&&(y.noIncludeFilesNotFound.length===0||y.noIncludeFilesNotFound.length>0&&te)?y.emitted=!0:(oe(" XXX Not emit due to exist files not found."),s("See documentation for emitOnIncludedFileNotFound and emitOnNoIncludedFileNotFound options."),y.emitted=!1),D&&(s(`
### statistics ###`),s("excludedTypings"),X.forEach(e=>{s(" - %s",e)}),s("used external typings"),I.forEach(e=>{H(e)&&s(" - %s",e)}),s("unused external typings"),I.forEach(e=>{H(e)||s(" - %s",e)}),s("external dependencies"),O.forEach(e=>{s(" - %s",e)})),s(`
### done ###
`),j;function f(e,o){!e&&D&&console.error(o||"assertion failed")}function je(e){D&&console.log(e)}function s(...e){D&&console.log(...e)}function oe(...e){D&&console.log(...e)}function ne(e){return r.relative(m,r.dirname(e)+r.sep+r.basename(e).replace(/\.d\.ts$/,""))}function G(e){return e===i?d:re(e)}function re(e){return N+d+F+ye(ne(e))}function K(e){return re(i)+F+N+F+e}function ye(e){return e.replace(/\.\./g,"--").replace(/[\\\/]/g,F)}function we(e){let o=b;return(e.length===0?"":o+e.join(a+o))+a}function ve(e,o){let n="";return n+="declare module '"+G(e)+"' {"+a,n+=we(o),n+="}"+a,n}async function ke(e){let o=ne(e);s("%s (%s)",o,e);let n={file:e,name:o,indent:b,exp:G(e),refs:[],externalImports:[],relativeImports:[],exports:[],lines:[],fileExists:!0,importLineRef:[],relativeRef:[]};try{let l=new URL(e),u=new URL(i);if(l.origin!==u.origin&&l.origin===window.location.origin)throw s(" X - Invalid URL: %s",e),new Error}catch{return n}let c=await fetch(e);if(!c.ok&&(e=e+"/index.d.ts",c=await fetch(e),!c.ok))return s(" X - File not found: %s",e),n.fileExists=!1,n;let p=(await c.text()).replace(De,"").replace(/\s*$/,"");if(p.includes(M)){let l=e.substring(0,e.lastIndexOf("/"))+"/";p=p.replace(new RegExp(_e(M)+"(.*)","g"),u=>r.relative(l,u))}n.indent=b||"    ";let w=[],q,Z=!1,ie=()=>{w.length>0&&(/^[ \t]*\/\*\*/.test(w[0])?q=w:z&&w.forEach(l=>n.lines.push({original:l})),w=[]),Z=!1},$e=()=>{q&&(q.forEach(l=>{let u=l.match(/^([ \t]*)(\*.*)/);u?n.lines.push({original:u[1]+" "+u[2]}):n.lines.push({original:l})}),q=null)};for(let l of p.split(`
`)){let u;if(/^[((=====)(=*)) \t]*\*+\//.test(l)){w.push(l),ie();continue}if(/^[ \t]*\/\*/.test(l)){w.push(l),Z=!0,/\*+\/[ \t]*$/.test(l)&&ie();continue}if(Z){w.push(l);continue}if(/^\s*$/.test(l)){n.lines.push({original:""});continue}if(/^\/\/\//.test(l)){let $=Oe(l);if($){let x=r.resolve(r.dirname(e),$);if(V(x))s(" - reference source typing %s (%s)",$,x);else{let E=r.relative(m,x).replace(/\\/g,"/");s(" - reference external typing %s (%s) (relative: %s)",$,x,E),Ue(x)||I.push(x)}v(n.refs,x);continue}}if(/^\/\//.test(l)){z&&n.lines.push({original:l});continue}if(Re.test(l)){q=null;continue}if($e(),l.indexOf("from")>=0&&(u=l.match(fe))||l.indexOf("require")>=0&&(u=l.match(Q))){let[$,x,E,h,S]=u;f(h);let U=r.resolve(r.dirname(e),h);if(U.startsWith("/")&&(U=U.replace("/https:/","https://").replace(".js",".d.ts")),qe.test(h)||h.startsWith(M)){let R={original:x+E+G(U)+S};n.lines.push(R);let P=U;(await fetch(P)).ok||(P+=".d.ts"),s(" - import relative %s (%s)",h,P),v(n.relativeImports,P),n.importLineRef.push(R)}else{let R={original:l};s(" - import external %s",h),v(n.externalImports,h),W&&n.importLineRef.push(R),n.lines.push(R)}}else if(u=l.match(me)){let[$,x,E,h,S]=u;f(h),s(" - declare %s",h),v(n.exports,h);let U={original:l};n.relativeRef.push(U),n.lines.push(U)}else{if(u=l.match(Me)){let[$,x,E,h,S,U]=u;l=x+E+S+U}V(e)?n.lines.push({original:l.replace(/^(export )?declare /g,"$1")}):n.lines.push({original:l})}}return n}}function v(t,r){return t.indexOf(r)<0&&t.push(r),t}function Ie(t,...r){return r.forEach(i=>i.forEach(d=>v(t,d))),t}function Le(t){return'/// <reference path="'+t.replace(/\\/g,"/")+'" />'}function Oe(t){let r=t.match(Te);return r?r[2]:null}function Se(t,r){let i=t.match(Q);return i&&Y.test(i[3])?i[1]+i[2]+r(i[3])+i[4]:t}function Pe(t,r){if(t.indexOf("from")<0)return t;let i=t.match(fe);return i&&Y.test(i[3])?i[1]+i[2]+r(i[3])+i[4]:t}function We(t,r){let i=t.match(me);if(i){let[d,m,a,b,N]=i;if(Y.test(b))return m+a+r(b)+N}return t}function ue(t,r){return i=>i.modified||i.original}function g(t,r){return typeof t>"u"?r:t}function _e(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}export{Ge as bundle};
