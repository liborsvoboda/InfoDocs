define(["require","exports","vscode-languageserver-types","../../fillers/monaco-editor-core"],(function(e,n,t,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SelectionRangeAdapter=n.FoldingRangeAdapter=n.DocumentColorAdapter=n.DocumentRangeFormattingEditProvider=n.DocumentFormattingEditProvider=n.DocumentLinkAdapter=n.DocumentSymbolAdapter=n.RenameAdapter=n.ReferenceAdapter=n.DefinitionAdapter=n.DocumentHighlightAdapter=n.HoverAdapter=n.toTextEdit=n.toRange=n.fromRange=n.fromPosition=n.CompletionAdapter=n.DiagnosticsAdapter=void 0;var i=function(){function e(e,n,t){var i=this;this._languageId=e,this._worker=n,this._disposables=[],this._listener=Object.create(null);var o=function(e){var n,t=e.getLanguageId();t===i._languageId&&(i._listener[e.uri.toString()]=e.onDidChangeContent((function(){window.clearTimeout(n),n=window.setTimeout((function(){return i._doValidate(e.uri,t)}),500)})),i._doValidate(e.uri,t))},a=function(e){r.editor.setModelMarkers(e,i._languageId,[]);var n=e.uri.toString(),t=i._listener[n];t&&(t.dispose(),delete i._listener[n])};this._disposables.push(r.editor.onDidCreateModel(o)),this._disposables.push(r.editor.onWillDisposeModel(a)),this._disposables.push(r.editor.onDidChangeModelLanguage((function(e){a(e.model),o(e.model)}))),this._disposables.push(t((function(e){r.editor.getModels().forEach((function(e){e.getLanguageId()===i._languageId&&(a(e),o(e))}))}))),this._disposables.push({dispose:function(){for(var e in r.editor.getModels().forEach(a),i._listener)i._listener[e].dispose()}}),r.editor.getModels().forEach(o)}return e.prototype.dispose=function(){this._disposables.forEach((function(e){return e&&e.dispose()})),this._disposables.length=0},e.prototype._doValidate=function(e,n){this._worker(e).then((function(n){return n.doValidation(e.toString())})).then((function(t){var i=t.map((function(e){return t="number"==typeof(n=e).code?String(n.code):n.code,{severity:o(n.severity),startLineNumber:n.range.start.line+1,startColumn:n.range.start.character+1,endLineNumber:n.range.end.line+1,endColumn:n.range.end.character+1,message:n.message,code:t,source:n.source};var n,t})),a=r.editor.getModel(e);a&&a.getLanguageId()===n&&r.editor.setModelMarkers(a,n,i)})).then(void 0,(function(e){console.error(e)}))},e}();function o(e){switch(e){case t.DiagnosticSeverity.Error:return r.MarkerSeverity.Error;case t.DiagnosticSeverity.Warning:return r.MarkerSeverity.Warning;case t.DiagnosticSeverity.Information:return r.MarkerSeverity.Info;case t.DiagnosticSeverity.Hint:return r.MarkerSeverity.Hint;default:return r.MarkerSeverity.Info}}n.DiagnosticsAdapter=i;var a=function(){function e(e,n){this._worker=e,this._triggerCharacters=n}return Object.defineProperty(e.prototype,"triggerCharacters",{get:function(){return this._triggerCharacters},enumerable:!1,configurable:!0}),e.prototype.provideCompletionItems=function(e,n,i,o){var a=e.uri;return this._worker(a).then((function(e){return e.doComplete(a.toString(),u(n))})).then((function(i){if(i){var o=e.getWordUntilPosition(n),a=new r.Range(n.lineNumber,o.startColumn,n.lineNumber,o.endColumn),u=i.items.map((function(e){var n,i,o={label:e.label,insertText:e.insertText||e.label,sortText:e.sortText,filterText:e.filterText,documentation:e.documentation,detail:e.detail,command:(n=e.command,n&&"editor.action.triggerSuggest"===n.command?{id:n.command,title:n.title,arguments:n.arguments}:void 0),range:a,kind:d(e.kind)};return e.textEdit&&(void 0!==(i=e.textEdit).insert&&void 0!==i.replace?o.range={insert:c(e.textEdit.insert),replace:c(e.textEdit.replace)}:o.range=c(e.textEdit.range),o.insertText=e.textEdit.newText),e.additionalTextEdits&&(o.additionalTextEdits=e.additionalTextEdits.map(l)),e.insertTextFormat===t.InsertTextFormat.Snippet&&(o.insertTextRules=r.languages.CompletionItemInsertTextRule.InsertAsSnippet),o}));return{isIncomplete:i.isIncomplete,suggestions:u}}}))},e}();function u(e){if(e)return{character:e.column-1,line:e.lineNumber-1}}function s(e){if(e)return{start:{line:e.startLineNumber-1,character:e.startColumn-1},end:{line:e.endLineNumber-1,character:e.endColumn-1}}}function c(e){if(e)return new r.Range(e.start.line+1,e.start.character+1,e.end.line+1,e.end.character+1)}function d(e){var n=r.languages.CompletionItemKind;switch(e){case t.CompletionItemKind.Text:return n.Text;case t.CompletionItemKind.Method:return n.Method;case t.CompletionItemKind.Function:return n.Function;case t.CompletionItemKind.Constructor:return n.Constructor;case t.CompletionItemKind.Field:return n.Field;case t.CompletionItemKind.Variable:return n.Variable;case t.CompletionItemKind.Class:return n.Class;case t.CompletionItemKind.Interface:return n.Interface;case t.CompletionItemKind.Module:return n.Module;case t.CompletionItemKind.Property:return n.Property;case t.CompletionItemKind.Unit:return n.Unit;case t.CompletionItemKind.Value:return n.Value;case t.CompletionItemKind.Enum:return n.Enum;case t.CompletionItemKind.Keyword:return n.Keyword;case t.CompletionItemKind.Snippet:return n.Snippet;case t.CompletionItemKind.Color:return n.Color;case t.CompletionItemKind.File:return n.File;case t.CompletionItemKind.Reference:return n.Reference}return n.Property}function l(e){if(e)return{range:c(e.range),text:e.newText}}n.CompletionAdapter=a,n.fromPosition=u,n.fromRange=s,n.toRange=c,n.toTextEdit=l;var g=function(){function e(e){this._worker=e}return e.prototype.provideHover=function(e,n,t){var r=e.uri;return this._worker(r).then((function(e){return e.doHover(r.toString(),u(n))})).then((function(e){if(e)return{range:c(e.range),contents:f(e.contents)}}))},e}();function m(e){return"string"==typeof e?{value:e}:(n=e)&&"object"==typeof n&&"string"==typeof n.kind?"plaintext"===e.kind?{value:e.value.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}:{value:e.value}:{value:"```"+e.language+"\n"+e.value+"\n```\n"};var n}function f(e){if(e)return Array.isArray(e)?e.map(m):[m(e)]}n.HoverAdapter=g;var p=function(){function e(e){this._worker=e}return e.prototype.provideDocumentHighlights=function(e,n,t){var r=e.uri;return this._worker(r).then((function(e){return e.findDocumentHighlights(r.toString(),u(n))})).then((function(e){if(e)return e.map((function(e){return{range:c(e.range),kind:h(e.kind)}}))}))},e}();function h(e){switch(e){case t.DocumentHighlightKind.Read:return r.languages.DocumentHighlightKind.Read;case t.DocumentHighlightKind.Write:return r.languages.DocumentHighlightKind.Write;case t.DocumentHighlightKind.Text:return r.languages.DocumentHighlightKind.Text}return r.languages.DocumentHighlightKind.Text}n.DocumentHighlightAdapter=p;var v=function(){function e(e){this._worker=e}return e.prototype.provideDefinition=function(e,n,t){var r=e.uri;return this._worker(r).then((function(e){return e.findDefinition(r.toString(),u(n))})).then((function(e){if(e)return[y(e)]}))},e}();function y(e){return{uri:r.Uri.parse(e.uri),range:c(e.range)}}n.DefinitionAdapter=v;var S=function(){function e(e){this._worker=e}return e.prototype.provideReferences=function(e,n,t,r){var i=e.uri;return this._worker(i).then((function(e){return e.findReferences(i.toString(),u(n))})).then((function(e){if(e)return e.map(y)}))},e}();n.ReferenceAdapter=S;var b=function(){function e(e){this._worker=e}return e.prototype.provideRenameEdits=function(e,n,t,i){var o=e.uri;return this._worker(o).then((function(e){return e.doRename(o.toString(),u(n),t)})).then((function(e){return function(e){if(e&&e.changes){var n=[];for(var t in e.changes)for(var i=r.Uri.parse(t),o=0,a=e.changes[t];o<a.length;o++){var u=a[o];n.push({resource:i,versionId:void 0,textEdit:{range:c(u.range),text:u.newText}})}return{edits:n}}}(e)}))},e}();n.RenameAdapter=b;var C=function(){function e(e){this._worker=e}return e.prototype.provideDocumentSymbols=function(e,n){var t=e.uri;return this._worker(t).then((function(e){return e.findDocumentSymbols(t.toString())})).then((function(e){if(e)return e.map((function(e){return"children"in e?k(e):{name:e.name,detail:"",containerName:e.containerName,kind:_(e.kind),range:c(e.location.range),selectionRange:c(e.location.range),tags:[]}}))}))},e}();function k(e){var n,t,r;return{name:e.name,detail:null!==(n=e.detail)&&void 0!==n?n:"",kind:_(e.kind),range:c(e.range),selectionRange:c(e.selectionRange),tags:null!==(t=e.tags)&&void 0!==t?t:[],children:(null!==(r=e.children)&&void 0!==r?r:[]).map((function(e){return k(e)}))}}function _(e){var n=r.languages.SymbolKind;switch(e){case t.SymbolKind.File:return n.File;case t.SymbolKind.Module:return n.Module;case t.SymbolKind.Namespace:return n.Namespace;case t.SymbolKind.Package:return n.Package;case t.SymbolKind.Class:return n.Class;case t.SymbolKind.Method:return n.Method;case t.SymbolKind.Property:return n.Property;case t.SymbolKind.Field:return n.Field;case t.SymbolKind.Constructor:return n.Constructor;case t.SymbolKind.Enum:return n.Enum;case t.SymbolKind.Interface:return n.Interface;case t.SymbolKind.Function:return n.Function;case t.SymbolKind.Variable:return n.Variable;case t.SymbolKind.Constant:return n.Constant;case t.SymbolKind.String:return n.String;case t.SymbolKind.Number:return n.Number;case t.SymbolKind.Boolean:return n.Boolean;case t.SymbolKind.Array:return n.Array}return n.Function}n.DocumentSymbolAdapter=C;var K=function(){function e(e){this._worker=e}return e.prototype.provideLinks=function(e,n){var t=e.uri;return this._worker(t).then((function(e){return e.findDocumentLinks(t.toString())})).then((function(e){if(e)return{links:e.map((function(e){return{range:c(e.range),url:e.target}}))}}))},e}();n.DocumentLinkAdapter=K;var w=function(){function e(e){this._worker=e}return e.prototype.provideDocumentFormattingEdits=function(e,n,t){var r=e.uri;return this._worker(r).then((function(e){return e.format(r.toString(),null,R(n)).then((function(e){if(e&&0!==e.length)return e.map(l)}))}))},e}();n.DocumentFormattingEditProvider=w;var I=function(){function e(e){this._worker=e,this.canFormatMultipleRanges=!1}return e.prototype.provideDocumentRangeFormattingEdits=function(e,n,t,r){var i=e.uri;return this._worker(i).then((function(e){return e.format(i.toString(),s(n),R(t)).then((function(e){if(e&&0!==e.length)return e.map(l)}))}))},e}();function R(e){return{tabSize:e.tabSize,insertSpaces:e.insertSpaces}}n.DocumentRangeFormattingEditProvider=I;var D=function(){function e(e){this._worker=e}return e.prototype.provideDocumentColors=function(e,n){var t=e.uri;return this._worker(t).then((function(e){return e.findDocumentColors(t.toString())})).then((function(e){if(e)return e.map((function(e){return{color:e.color,range:c(e.range)}}))}))},e.prototype.provideColorPresentations=function(e,n,t){var r=e.uri;return this._worker(r).then((function(e){return e.getColorPresentations(r.toString(),n.color,s(n.range))})).then((function(e){if(e)return e.map((function(e){var n={label:e.label};return e.textEdit&&(n.textEdit=l(e.textEdit)),e.additionalTextEdits&&(n.additionalTextEdits=e.additionalTextEdits.map(l)),n}))}))},e}();n.DocumentColorAdapter=D;var x=function(){function e(e){this._worker=e}return e.prototype.provideFoldingRanges=function(e,n,i){var o=e.uri;return this._worker(o).then((function(e){return e.getFoldingRanges(o.toString(),n)})).then((function(e){if(e)return e.map((function(e){var n={start:e.startLine+1,end:e.endLine+1};return void 0!==e.kind&&(n.kind=function(e){switch(e){case t.FoldingRangeKind.Comment:return r.languages.FoldingRangeKind.Comment;case t.FoldingRangeKind.Imports:return r.languages.FoldingRangeKind.Imports;case t.FoldingRangeKind.Region:return r.languages.FoldingRangeKind.Region}}(e.kind)),n}))}))},e}();n.FoldingRangeAdapter=x;var E=function(){function e(e){this._worker=e}return e.prototype.provideSelectionRanges=function(e,n,t){var r=e.uri;return this._worker(r).then((function(e){return e.getSelectionRanges(r.toString(),n.map(u))})).then((function(e){if(e)return e.map((function(e){for(var n=[];e;)n.push({range:c(e.range)}),e=e.parent;return n}))}))},e}();n.SelectionRangeAdapter=E}));